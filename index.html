<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiragana Pro - Clean Workbook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        
        body {
            background-color: #f1f5f9; /* 밝은 배경으로 변경하여 워크북과 조화 */
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        /* 워크북 컨테이너: 가리는 것 없이 이미지가 전체 다 보이도록 설정 */
        .workbook-container {
            position: relative;
            width: 95vw;
            max-width: 1200px;
            aspect-ratio: 16 / 9;
            background-image: url('001_00.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-color: white;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-radius: 8px;
        }

        /* 투명 캔버스: 전체 영역에 씌우되 배경을 가리지 않음 */
        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            cursor: crosshair;
            touch-action: none;
        }

        /* 하단 미니 피드백 컨트롤: 투명도를 높이고 크기를 줄임 */
        .control-overlay {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            display: flex;
            gap: 12px;
            align-items: center;
            background: rgba(15, 23, 42, 0.7); /* 반투명 다크 */
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 100px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .stat-badge {
            font-size: 11px;
            font-weight: 800;
            color: #94a3b8;
            letter-spacing: 0.05em;
        }

        .stat-value {
            color: #4ade80; /* 네온 그린 */
            font-size: 16px;
            font-weight: 900;
        }

        .btn-sm {
            padding: 6px 16px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 800;
            transition: all 0.2s;
        }

        /* 성공 애니메이션 */
        #success-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 30;
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>

    <div class="workbook-container" id="workbookFrame">
        <!-- 배경 이미지는 CSS의 background-image로 들어갑니다 -->

        <!-- 투명 드로잉 캔버스 -->
        <canvas id="drawingCanvas"></canvas>

        <!-- 미니멀 컨트롤 오버레이 (워크북 하단 중앙에 작게 위치) -->
        <div class="control-overlay">
            <div class="flex flex-col items-center border-r border-white/10 pr-4">
                <span class="stat-badge uppercase">Target</span>
                <span class="text-white font-bold">あ [a]</span>
            </div>
            
            <div class="flex flex-col items-center border-r border-white/10 px-4">
                <span class="stat-badge uppercase">Strokes</span>
                <span id="strokeCount" class="stat-value">0 / 3</span>
            </div>

            <div id="msgDisplay" class="text-white/80 text-[11px] font-medium px-4 max-w-[200px] leading-tight">
                격자 칸 위에 직접 써보세요.
            </div>

            <div class="flex gap-2 ml-2">
                <button onclick="clearCanvas()" class="btn-sm bg-white/10 hover:bg-white/20 text-white">CLEAR</button>
                <button onclick="checkResult()" class="btn-sm bg-green-500 hover:bg-green-400 text-slate-900">CHECK</button>
            </div>
        </div>

        <!-- 성공 팝업 -->
        <div id="success-msg" class="text-center">
            <div class="text-6xl mb-2 animate-bounce">✨</div>
            <div class="bg-slate-900/90 text-white px-6 py-2 rounded-full font-black italic">EXCELLENT!</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const frame = document.getElementById('workbookFrame');
        let isDrawing = false;
        let strokeCount = 0;

        function initCanvas() {
            canvas.width = frame.clientWidth;
            canvas.height = frame.clientHeight;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#2563eb'; // 신뢰감을 주는 블루
        }

        window.addEventListener('load', initCanvas);
        window.addEventListener('resize', initCanvas);

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: (clientX - rect.left) * (canvas.width / rect.width),
                y: (clientY - rect.top) * (canvas.height / rect.height)
            };
        }

        function startDrawing(e) {
            isDrawing = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            strokeCount++;
            document.getElementById('strokeCount').innerText = `${strokeCount} / 3`;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            strokeCount = 0;
            document.getElementById('strokeCount').innerText = `0 / 3`;
            document.getElementById('msgDisplay').innerText = "격자 칸 위에 직접 써보세요.";
            document.getElementById('msgDisplay').classList.remove('text-green-400', 'text-red-400');
        }

        function checkResult() {
            const msg = document.getElementById('msgDisplay');
            if (strokeCount === 3) {
                msg.innerText = "완벽한 획순입니다!";
                msg.classList.add('text-green-400');
                const success = document.getElementById('success-msg');
                success.style.display = 'block';
                setTimeout(() => success.style.display = 'none', 1500);
            } else {
                msg.innerText = "'あ'는 3획입니다. 다시 써볼까요?";
                msg.classList.add('text-red-400');
            }
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
        canvas.addEventListener('touchend', stopDrawing);

    </script>
</body>
</html>