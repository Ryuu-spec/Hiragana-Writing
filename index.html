<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiragana Pro - Interactive Workbook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        
        body {
            background-color: #0f172a;
            color: #f8fafc;
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        /* 워크북 컨테이너 */
        .workbook-frame {
            position: relative;
            width: 95vw;
            max-width: 1200px;
            aspect-ratio: 16 / 9;
            background-image: url('001_00.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            border: 4px solid #1e293b;
        }

        /* 투명 캔버스 레이어: 이상한 커서 아이콘 제거 및 기본 크로스헤어 적용 */
        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20;
            cursor: crosshair; /* 깔끔한 십자선 커서로 변경 */
            touch-action: none;
        }

        /* 하단 플로팅 피드백 바 */
        .feedback-bar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 30;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .accent-neon {
            color: #4ade80;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }

        .btn-action {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-action:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>

    <div class="workbook-frame" id="workbookFrame">
        <canvas id="drawingCanvas"></canvas>

        <div class="feedback-bar">
            <div class="flex items-center gap-6">
                <div>
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Target</p>
                    <p class="text-xl font-black accent-neon">あ <span class="text-xs font-normal text-white/50 ml-1">[a]</span></p>
                </div>
                <div class="h-8 w-[1px] bg-slate-700"></div>
                <div>
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Strokes</p>
                    <p id="strokeCount" class="text-xl font-black italic">0 / 3</p>
                </div>
                <div class="hidden md:block ml-4">
                    <p id="aiFeedback" class="text-sm font-medium text-slate-300">오른쪽 연습 칸에 직접 써보세요.</p>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button onclick="clearCanvas()" class="btn-action px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 text-xs font-bold border border-slate-600">CLEAR</button>
                <button onclick="analyzeWriting()" class="btn-action px-5 py-2 rounded-xl bg-green-500 hover:bg-green-400 text-slate-900 text-xs font-black shadow-lg shadow-green-500/20">ANALYZE</button>
            </div>
        </div>
    </div>

    <div id="successOverlay" class="fixed inset-0 bg-green-500/10 backdrop-blur-sm hidden z-50 flex items-center justify-center pointer-events-none">
        <div class="text-center animate-bounce">
            <span class="text-8xl">✨</span>
            <h2 class="text-4xl font-black text-white mt-4 italic">PERFECT!</h2>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const frame = document.getElementById('workbookFrame');
        let isDrawing = false;
        let strokeCount = 0;

        function resizeCanvas() {
            canvas.width = frame.clientWidth;
            canvas.height = frame.clientHeight;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#2563eb';
        }

        window.addEventListener('load', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: (clientX - rect.left) * (canvas.width / rect.width),
                y: (clientY - rect.top) * (canvas.height / rect.height)
            };
        }

        function startDrawing(e) {
            isDrawing = true;
            const pos = getMousePos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            const pos = getMousePos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            strokeCount++;
            document.getElementById('strokeCount').innerText = `${strokeCount} / 3`;
            updateFeedback();
        }

        function updateFeedback() {
            const fb = document.getElementById('aiFeedback');
            if(strokeCount === 1) fb.innerText = "좋아요! 두 번째 획을 이어서 그려보세요.";
            if(strokeCount === 2) fb.innerText = "마지막 곡선 획만 남았습니다. 균형에 주의하세요.";
            if(strokeCount === 3) fb.innerText = "획순 완성! 'ANALYZE' 버튼을 눌러보세요.";
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            strokeCount = 0;
            document.getElementById('strokeCount').innerText = `0 / 3`;
            document.getElementById('aiFeedback').innerText = "오른쪽 연습 칸에 직접 써보세요.";
            document.getElementById('aiFeedback').classList.remove('text-green-400');
        }

        function analyzeWriting() {
            if (strokeCount === 0) return;
            const fb = document.getElementById('aiFeedback');
            if(strokeCount === 3) {
                fb.innerText = "완벽한 획순입니다! 형태가 매우 수려하네요.";
                fb.classList.add('text-green-400');
                const overlay = document.getElementById('successOverlay');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.add('hidden'), 2000);
            } else {
                fb.innerText = "획순이 맞지 않습니다. 'あ'는 총 3획입니다.";
                fb.classList.add('text-red-400');
            }
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
        canvas.addEventListener('touchend', stopDrawing);
    </script>
</body>
</html>