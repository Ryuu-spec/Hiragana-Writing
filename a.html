<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ã‚ ì“°ê¸° ì—°ìŠµ ì˜¤ë²„ë ˆì´ v2</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
  width: 1200px;
  height: 675px;
  overflow: hidden;
  background: transparent;
  font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', sans-serif;
  user-select: none;
}

#app {
  position: relative;
  width: 1200px;
  height: 675px;
  background: transparent;
}

/* â”€â”€ íš ì¸ë””ì¼€ì´í„° (ìƒë‹¨ ìŠ¬ë¼ì´ë“œ ì œëª© ì•„ë˜) â”€â”€ */
#stroke-bar {
  position: absolute;
  left: 642px;
  top: 162px;
  display: flex;
  gap: 7px;
  z-index: 80;
  pointer-events: none;
}
.sdot {
  width: 30px; height: 30px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 900; color: white;
  opacity: 0.3;
  transition: opacity .3s, transform .3s, box-shadow .3s;
  box-shadow: 0 2px 6px rgba(0,0,0,.2);
}
.sdot.active  { opacity: 1; transform: scale(1.25); box-shadow: 0 4px 12px rgba(0,0,0,.35); }
.sdot.done    { opacity: 0.85; }
#sd1 { background: #3B82F6; }
#sd2 { background: #10B981; }
#sd3 { background: #F59E0B; }

/* â”€â”€ ê²©ì ì˜¤ë²„ë ˆì´ â”€â”€ */
#grid {
  position: absolute;
  left: 642px;
  top: 197px;
  width: 493px;
  height: 389px;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  grid-template-rows: repeat(4, 1fr);
  background: transparent;
}

.cell {
  position: relative;
  cursor: crosshair;
  background: transparent;
  touch-action: none;
}

.cell canvas {
  position: absolute;
  inset: 0;
  width: 100%; height: 100%;
  background: transparent;
}

/* ì…€ í™œì„± ë§ */
.cell.is-active::before {
  content:'';
  position: absolute;
  inset: 2px;
  border: 2px dashed rgba(59,130,246,.55);
  border-radius: 3px;
  pointer-events: none;
  animation: dashPulse 1.2s linear infinite;
}
@keyframes dashPulse {
  to { border-color: rgba(59,130,246,1); }
}

/* ê²°ê³¼ ë°°ì§€ */
.cell .badge {
  position: absolute;
  bottom: 3px; right: 4px;
  font-size: 15px;
  font-weight: 900;
  pointer-events: none;
  line-height: 1;
}

/* â”€â”€ í•˜ë‹¨ ì»¨íŠ¸ë¡¤ â”€â”€ */
#ctrl {
  position: absolute;
  bottom: 14px;
  left: 642px;
  display: flex;
  gap: 10px;
  z-index: 80;
}
.cbtn {
  padding: 7px 18px;
  border: none;
  border-radius: 22px;
  font-size: 12px;
  font-weight: 800;
  cursor: pointer;
  letter-spacing: .3px;
  transition: opacity .15s, transform .15s;
}
.cbtn:hover  { opacity: .82; transform: translateY(-1px); }
.cbtn:active { transform: translateY(0); }
#bClear { background:#EF4444; color:#fff; }
#bUndo  { background:#8B5CF6; color:#fff; }

/* â”€â”€ í”¼ë“œë°± í† ìŠ¤íŠ¸ â”€â”€ */
#toast {
  position: absolute;
  left: 50%; top: 80px;
  transform: translateX(-50%);
  padding: 9px 22px;
  border-radius: 18px;
  font-size: 14px; font-weight: 800;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity .25s;
  z-index: 200;
  box-shadow: 0 4px 20px rgba(0,0,0,.22);
}
#toast.show { opacity: 1; }
#toast.ok   { background: #10B981; color:#fff; }
#toast.ng   { background: #EF4444; color:#fff; }
#toast.info { background: rgba(255,255,255,.94); color:#333;
               border: 1.5px solid #ddd; }
</style>
</head>
<body>
<div id="app">

  <!-- íš ì¸ë””ì¼€ì´í„° -->
  <div id="stroke-bar">
    <div class="sdot active" id="sd1">1</div>
    <div class="sdot"        id="sd2">2</div>
    <div class="sdot"        id="sd3">3</div>
  </div>

  <!-- ê²©ì -->
  <div id="grid"></div>

  <!-- í”¼ë“œë°± -->
  <div id="toast"></div>

  <!-- ì»¨íŠ¸ë¡¤ -->
  <div id="ctrl">
    <button class="cbtn" id="bUndo">â†© ì´ì „ íš ì§€ìš°ê¸°</button>
    <button class="cbtn" id="bClear">ğŸ—‘ ì „ì²´ ì§€ìš°ê¸°</button>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì„¤ì •
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COLS = 5, ROWS = 4;
const COLORS  = ['#3B82F6','#10B981','#F59E0B']; // 1Â·2Â·3íš
const WIDTHS  = [3.5, 3.5, 3.5];
const MAX_STROKES = 3;

/* â”€â”€ ã‚ 3íš ê¸°ì¤€ (ì •ê·œí™” 0~1, ì…€ ë‚´ë¶€) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1íš: ìƒë‹¨ ê°€ë¡œíš
       Â· ì‹œì‘ Y < 0.45  (ìƒë‹¨ ì ˆë°˜)
       Â· ìˆ˜í‰ ìš°ì„¸ (spanX > spanY * 1.2)
       Â· ì˜¤ë¥¸ìª½ ë°©í–¥ (endX > startX)

  2íš: ì¤‘ê°„ ì„¸ë¡œ/ì‚¬ì„ íš  
       Â· ì‹œì‘ X < 0.60 (ì™¼ìª½~ì¤‘ì•™)
       Â· ì‹œì‘ Y: 0.25 ~ 0.65
       Â· ìˆ˜ì§ ìš°ì„¸ ë˜ëŠ” ì•½ê°„ ì‚¬ì„ 
       Â· ì´ ê¸¸ì´ â‰¥ 0.25 (ì¶©ë¶„íˆ ê¸´ íš)

  3íš: ì˜¤ë¥¸ìª½ í° ì›+ê¼¬ë¦¬
       Â· ì‹œì‘ X > 0.30 (ì˜¤ë¥¸ìª½ ì ˆë°˜ ì´ìƒ)
       Â· ì‹œì‘ Y < 0.55
       Â· íšì´ ê°€ì¥ ê¸¸ê±°ë‚˜ ê³¡ë¥ ì´ í¼
       Â· spanX + spanY í•©ì´ ê°€ì¥ í¼ (or â‰¥ 0.5)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì…€ ì´ˆê¸°í™”
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const gridEl = document.getElementById('grid');
const cellArr = [];  // { el, cvs, ctx, strokes[], pts[], drawing, done }

for(let i=0;i<COLS*ROWS;i++){
  const div = document.createElement('div');
  div.className = 'cell';
  div.dataset.i = i;

  const cvs = document.createElement('canvas');
  div.appendChild(cvs);
  gridEl.appendChild(div);

  const ctx = cvs.getContext('2d');
  ctx.lineCap = 'round'; ctx.lineJoin = 'round';

  cellArr.push({ el:div, cvs, ctx, strokes:[], pts:[], drawing:false, done:false });
}

/* canvas ì‹¤ì œ í”½ì…€ í¬ê¸° ë§ì¶”ê¸° */
function resizeCells(){
  cellArr.forEach(c=>{
    const r = c.el.getBoundingClientRect();
    c.cvs.width  = Math.round(r.width);
    c.cvs.height = Math.round(r.height);
    redraw(c);
  });
}
window.addEventListener('load', resizeCells);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í™œì„± ì…€ ê´€ë¦¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let activeIdx = 0;

function activateCell(idx){
  cellArr.forEach((c,i)=>{
    c.el.classList.toggle('is-active', i===idx && !c.done);
  });
  activeIdx = idx;
  updateDots(cellArr[idx]?.strokes.length ?? 0);
}
activateCell(0);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   íš ì¸ë””ì¼€ì´í„°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateDots(n){
  [1,2,3].forEach(i=>{
    const d = document.getElementById('sd'+i);
    d.classList.remove('active','done');
    if(i < n+1)      d.classList.add('done');
    else if(i===n+1) d.classList.add('active');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì¢Œí‘œ ì·¨ë“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getXY(cvs, e){
  const r = cvs.getBoundingClientRect();
  const src = e.touches ? e.touches[0] : e;
  return {
    x:(src.clientX - r.left) * (cvs.width/r.width),
    y:(src.clientY - r.top)  * (cvs.height/r.height)
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ìŠ¤ë¬´ìŠ¤ ë“œë¡œì‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function smooth(ctx, pts, color, w){
  if(pts.length < 2) return;
  ctx.save();
  ctx.strokeStyle = color; ctx.lineWidth = w;
  ctx.beginPath();
  ctx.moveTo(pts[0].x, pts[0].y);
  for(let i=1;i<pts.length-1;i++){
    const mx=(pts[i].x+pts[i+1].x)/2, my=(pts[i].y+pts[i+1].y)/2;
    ctx.quadraticCurveTo(pts[i].x,pts[i].y,mx,my);
  }
  ctx.lineTo(pts[pts.length-1].x, pts[pts.length-1].y);
  ctx.stroke();
  // ì‹œì‘ì  ì›
  ctx.beginPath();
  ctx.arc(pts[0].x, pts[0].y, w*1.1, 0, Math.PI*2);
  ctx.fillStyle = color; ctx.fill();
  ctx.restore();
}

function redraw(c){
  c.ctx.clearRect(0,0,c.cvs.width,c.cvs.height);
  c.strokes.forEach((s,i)=> smooth(c.ctx, s, COLORS[i], WIDTHS[i]));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   íšìˆœ ë¶„ì„  â˜… í•µì‹¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function feat(pts, W, H){
  if(!pts||pts.length<2) return null;
  const xs=pts.map(p=>p.x), ys=pts.map(p=>p.y);
  const minX=Math.min(...xs), maxX=Math.max(...xs);
  const minY=Math.min(...ys), maxY=Math.max(...ys);
  const spanX=(maxX-minX)/W, spanY=(maxY-minY)/H;

  // ì´ íš ê¸¸ì´ (í”½ì…€ í•©ì‚°, ì •ê·œí™”)
  let len=0;
  for(let i=1;i<pts.length;i++){
    const dx=pts[i].x-pts[i-1].x, dy=pts[i].y-pts[i-1].y;
    len+=Math.sqrt(dx*dx+dy*dy);
  }
  len /= (W+H)/2;

  // ê³¡ë¥  ì¶”ì •: ë°©í–¥ ë³€í™” íšŸìˆ˜
  let turns=0;
  for(let i=2;i<pts.length;i++){
    const ax=pts[i-1].x-pts[i-2].x, ay=pts[i-1].y-pts[i-2].y;
    const bx=pts[i].x-pts[i-1].x,   by=pts[i].y-pts[i-1].y;
    const cross=ax*by-ay*bx;
    if(i>2){
      const ax2=pts[i-2].x-pts[i-3].x, ay2=pts[i-2].y-pts[i-3].y;
      const cross2=ax2*by-ay2*bx;
      if(cross*cross2<0) turns++;
    }
  }

  return {
    sX: pts[0].x/W, sY: pts[0].y/H,   // ì‹œì‘ì  ì •ê·œí™”
    eX: pts[pts.length-1].x/W, eY: pts[pts.length-1].y/H,
    spanX, spanY,
    cX: (minX+maxX)/(2*W), cY: (minY+maxY)/(2*H),  // ì¤‘ì‹¬
    len, turns,
    horiz: spanX > spanY*1.15,
    vert:  spanY > spanX*1.05,
  };
}

function checkStrokes(strokes, W, H){
  if(strokes.length !== MAX_STROKES) return null;

  const [f0, f1, f2] = strokes.map(s => feat(s, W, H));
  const errs = [];
  let score = 0;  // 0~3

  /* â”€â”€ 1íš ê²€ì‚¬: ìƒë‹¨ ê°€ë¡œíš â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Â· ì‹œì‘ Y < 0.48
     Â· ê°€ë¡œ ë°©í–¥ (spanX > spanY*1.1 OR spanX > 0.3)
     Â· ì˜¤ë¥¸ìª½ìœ¼ë¡œ í–¥í•¨ (eX > sX - 0.1)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const ok1_startY = f0.sY < 0.50;
  const ok1_horiz  = f0.spanX > 0.28 || f0.horiz;
  const ok1_dir    = f0.eX >= f0.sX - 0.15;  // ì˜¤ë¥¸ìª½ ë°©í–¥

  if(ok1_startY && ok1_horiz && ok1_dir){
    score++;
  } else {
    if(!ok1_startY) errs.push('1íšì€ ìœ„ìª½(ìƒë‹¨)ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”');
    else if(!ok1_horiz) errs.push('1íšì€ ê°€ë¡œë¡œ ê·¸ì–´ì•¼ í•´ìš”');
    else if(!ok1_dir)   errs.push('1íšì€ ì˜¤ë¥¸ìª½ ë°©í–¥ìœ¼ë¡œ ê·¸ì–´ì•¼ í•´ìš”');
  }

  /* â”€â”€ 2íš ê²€ì‚¬: ì¤‘ê°„ ì„¸ë¡œ/ì‚¬ì„ íš â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Â· ì‹œì‘ X < 0.65 (ì™¼ìª½~ì¤‘ì•™)
     Â· ì‹œì‘ Y 0.20 ~ 0.68
     Â· ì„¸ë¡œ ë°©í–¥ ìš°ì„¸ OR ëŒ€ê°ì„  (spanY > 0.25)
     Â· 1íš ì‹œì‘ë³´ë‹¤ Yê°€ ì•„ë˜ì— ìˆìŒ
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const ok2_startX  = f1.sX < 0.68;
  const ok2_startY  = f1.sY > 0.15 && f1.sY < 0.72;
  const ok2_vert    = f1.spanY > 0.22;
  const ok2_order   = f1.sY >= f0.sY - 0.15;  // 1íšë³´ë‹¤ ë„ˆë¬´ ìœ„ì´ë©´ ì•ˆë¨

  if(ok2_startX && ok2_startY && ok2_vert && ok2_order){
    score++;
  } else {
    if(!ok2_startX)  errs.push('2íšì€ ì™¼ìª½(ì¤‘ì•™)ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”');
    else if(!ok2_startY) errs.push('2íšì˜ ì‹œì‘ ìœ„ì¹˜ë¥¼ ì¡°ì •í•´ ì£¼ì„¸ìš”');
    else if(!ok2_vert)   errs.push('2íšì€ ì•„ë˜ë¡œ ë‚´ë ¤ê·¸ì–´ì•¼ í•´ìš”');
    else if(!ok2_order)  errs.push('2íšì€ 1íš ì´í›„ì— ê·¸ì–´ì•¼ í•´ìš”');
  }

  /* â”€â”€ 3íš ê²€ì‚¬: ì˜¤ë¥¸ìª½ í° ì›+ê¼¬ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Â· ì‹œì‘ X > 0.25 (ì¤‘ì•™ ì´ìƒ)
     Â· ì‹œì‘ Y < 0.62
     Â· íš ê¸¸ì´ ê°€ì¥ ê¹€ (ì„¸ íš ì¤‘ max)
       OR spanX+spanY ê°€ ê°€ì¥ í¼
     Â· 1íšÂ·2íšë³´ë‹¤ ë³µì¡ (len ê¸°ì¤€)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const ok3_startX = f2.sX > 0.20;
  const ok3_startY = f2.sY < 0.65;
  const lens = [f0.len, f1.len, f2.len];
  const ok3_longest = f2.len >= Math.max(...lens)*0.75;  // ê°€ì¥ ê¸¸ê±°ë‚˜ ë¹„ìŠ·í•œ ê¸¸ì´
  const ok3_span    = (f2.spanX+f2.spanY) >= Math.max(f0.spanX+f0.spanY, f1.spanX+f1.spanY)*0.7;

  if(ok3_startX && ok3_startY && (ok3_longest || ok3_span)){
    score++;
  } else {
    if(!ok3_startX)   errs.push('3íšì€ ì˜¤ë¥¸ìª½ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”');
    else if(!ok3_startY) errs.push('3íšì˜ ì‹œì‘ì ì„ ìœ„ë¡œ ì˜¬ë ¤ì£¼ì„¸ìš”');
    else              errs.push('3íšì„ ë” í¬ê²Œ ê·¸ë ¤ì£¼ì„¸ìš” (í° ì›+ê¼¬ë¦¬)');
  }

  return { score, errs, correct: score === 3 };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í† ìŠ¤íŠ¸ ë©”ì‹œì§€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer;
function toast(msg, type='info', ms=1800){
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = `show ${type}`;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ el.className=''; }, ms);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì´ë²¤íŠ¸ ë“±ë¡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
cellArr.forEach((c, idx)=>{
  const {cvs} = c;

  function onStart(e){
    e.preventDefault();
    if(c.done) return;
    activateCell(idx);
    if(c.strokes.length >= MAX_STROKES){
      toast('3íš ì™„ë£Œ! â†© ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¬ê±°ë‚˜ ì „ì²´ ì§€ìš°ê¸° í•˜ì„¸ìš”','info'); return;
    }
    c.drawing = true;
    c.pts = [getXY(cvs, e)];
  }

  function onMove(e){
    e.preventDefault();
    if(!c.drawing) return;
    c.pts.push(getXY(cvs, e));
    redraw(c);
    smooth(c.ctx, c.pts, COLORS[c.strokes.length], WIDTHS[c.strokes.length]);
  }

  function onEnd(e){
    e.preventDefault();
    if(!c.drawing) return;
    c.drawing = false;
    if(c.pts.length < 4){ c.pts=[]; return; }

    c.strokes.push([...c.pts]);
    c.pts = [];
    redraw(c);
    updateDots(c.strokes.length);

    if(c.strokes.length === MAX_STROKES){
      const W=c.cvs.width, H=c.cvs.height;
      const res = checkStrokes(c.strokes, W, H);

      // ë°°ì§€ ì œê±° í›„ ì¬ìƒì„±
      c.el.querySelectorAll('.badge').forEach(b=>b.remove());
      const badge = document.createElement('div');
      badge.className = 'badge';

      if(res.correct){
        badge.textContent = 'âœ“';
        badge.style.color = '#10B981';
        c.el.classList.remove('is-active');
        c.done = true;
        toast('ğŸ‰ íšìˆœ ì™„ë²½! ì˜ ì¼ì–´ìš”!','ok', 2200);
        // ìë™ ë‹¤ìŒ ì…€
        const next = cellArr.findIndex((cc,i)=> i>idx && !cc.done);
        if(next !== -1) setTimeout(()=> activateCell(next), 900);
      } else {
        badge.textContent = 'âœ—';
        badge.style.color = '#EF4444';
        const msg = res.errs[0] || 'íšìˆœì„ ë‹¤ì‹œ í™•ì¸í•´ ë³´ì„¸ìš”';
        toast(`âš ï¸ ${msg}`,'ng', 3000);
      }
      c.el.appendChild(badge);
    } else {
      const left = MAX_STROKES - c.strokes.length;
      toast(`${c.strokes.length}íš ì™„ë£Œ âœ“  ë‚¨ì€ íš: ${left}ê°œ`,'info',1200);
    }
  }

  cvs.addEventListener('mousedown', onStart);
  cvs.addEventListener('mousemove', onMove);
  cvs.addEventListener('mouseup',   onEnd);
  cvs.addEventListener('mouseleave',onEnd);
  cvs.addEventListener('touchstart', onStart,{passive:false});
  cvs.addEventListener('touchmove',  onMove, {passive:false});
  cvs.addEventListener('touchend',   onEnd,  {passive:false});
});

/* â”€â”€ ì´ì „ íš ì§€ìš°ê¸° â”€â”€ */
document.getElementById('bUndo').addEventListener('click',()=>{
  const c = cellArr[activeIdx];
  if(!c || c.strokes.length === 0){ toast('ì§€ìš¸ íšì´ ì—†ì–´ìš”','info'); return; }
  c.strokes.pop();
  c.done = false;
  c.el.querySelectorAll('.badge').forEach(b=>b.remove());
  c.el.classList.add('is-active');
  redraw(c);
  updateDots(c.strokes.length);
  toast(`â†© ${c.strokes.length+1}íš ì·¨ì†Œ`,'info',1000);
});

/* â”€â”€ ì „ì²´ ì§€ìš°ê¸° â”€â”€ */
document.getElementById('bClear').addEventListener('click',()=>{
  cellArr.forEach(c=>{
    c.strokes=[]; c.pts=[]; c.drawing=false; c.done=false;
    c.el.querySelectorAll('.badge').forEach(b=>b.remove());
    c.el.classList.remove('is-active');
    c.ctx.clearRect(0,0,c.cvs.width,c.cvs.height);
  });
  activateCell(0);
  toast('ğŸ—‘ ì „ì²´ ì§€ì› ì–´ìš”! ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”','info',1500);
});

updateDots(0);
</script>
</body>
</html>
