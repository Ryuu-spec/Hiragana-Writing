<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ã‚ ì“°ê¸° ì—°ìŠµ</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body {
  width: 1200px; height: 675px;
  overflow: hidden;
  background: transparent;
  font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
  user-select: none;
  -webkit-user-select: none;
}
#app {
  position: relative;
  width: 1200px; height: 675px;
  background: transparent;
}

/* â”€â”€ íš ì¸ë””ì¼€ì´í„° â”€â”€ */
#dots {
  position: absolute;
  left: 647px; top: 168px;
  display: flex; gap: 8px;
  pointer-events: none; z-index: 90;
}
.dot {
  width: 32px; height: 32px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; font-weight: 900; color: #fff;
  opacity: .25; transition: opacity .3s, transform .3s;
  box-shadow: 0 2px 8px rgba(0,0,0,.25);
}
.dot.on   { opacity:1; transform:scale(1.3); }
.dot.done { opacity:.8; }
#d1{background:#3B82F6;} #d2{background:#10B981;} #d3{background:#F59E0B;}

/* â”€â”€ ê²©ì â”€â”€ */
#grid {
  position: absolute;
  left: 647px; top: 206px;
  width: 483px; height: 381px;
  display: grid;
  grid-template-columns: repeat(5, 96.6px);
  grid-template-rows: repeat(4, 95.25px);
  background: transparent;
}
.cell {
  position: relative;
  width: 96.6px; height: 95.25px;
  cursor: crosshair;
  background: transparent;
  touch-action: none;
}
.cell.active::before {
  content:''; position:absolute; inset:2px;
  border: 2px dashed rgba(59,130,246,.6);
  border-radius: 3px; pointer-events:none;
  animation: blink 1s linear infinite;
}
@keyframes blink { 50%{border-color:rgba(59,130,246,1);} }
.badge {
  position:absolute; bottom:3px; right:5px;
  font-size:16px; font-weight:900;
  pointer-events:none; line-height:1;
}
.cell canvas {
  position: absolute; top:0; left:0;
  width: 96.6px; height: 95.25px;
  touch-action: none;
  display: block;
}

/* â”€â”€ ì»¨íŠ¸ë¡¤ â”€â”€ */
#ctrl {
  position: absolute;
  top: 598px; left: 647px;
  display: flex; gap: 10px; z-index: 90;
}
.btn {
  padding: 7px 18px; border:none; border-radius:22px;
  font-size:12px; font-weight:800; cursor:pointer;
  transition: opacity .15s, transform .15s;
  box-shadow: 0 2px 8px rgba(0,0,0,.2);
}
.btn:hover  { opacity:.82; transform:translateY(-1px); }
.btn:active { transform:translateY(0); }
#bUndo  { background:#8B5CF6; color:#fff; }
#bClear { background:#EF4444; color:#fff; }

/* â”€â”€ í† ìŠ¤íŠ¸ â”€â”€ */
#toast {
  position:absolute; left:889px; top:155px;
  transform:translateX(-50%);
  padding:9px 24px; border-radius:18px;
  font-size:14px; font-weight:800;
  white-space:nowrap; pointer-events:none;
  opacity:0; transition:opacity .2s; z-index:200;
  box-shadow:0 4px 20px rgba(0,0,0,.2);
}
#toast.show { opacity:1; }
.t-ok   { background:#10B981; color:#fff; }
.t-ng   { background:#EF4444; color:#fff; }
.t-info { background:rgba(255,255,255,.95); color:#333; border:1.5px solid #ddd; }
</style>
</head>
<body>
<div id="app">
  <div id="dots">
    <div class="dot on" id="d1">1</div>
    <div class="dot"    id="d2">2</div>
    <div class="dot"    id="d3">3</div>
  </div>
  <div id="grid"></div>
  <div id="toast"></div>
  <div id="ctrl">
    <button class="btn" id="bUndo">â†© ì´ì „ íš ì§€ìš°ê¸°</button>
    <button class="btn" id="bClear">ğŸ—‘ ì „ì²´ ì§€ìš°ê¸°</button>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì„¤ì •
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CELL_CSS_W = 96.6;
const CELL_CSS_H = 95.25;
const CVS_W = 194;   // 2Ã— í•´ìƒë„
const CVS_H = 191;
const SCALE_X = CVS_W / CELL_CSS_W;  // ~2.0
const SCALE_Y = CVS_H / CELL_CSS_H;

const COLS=5, ROWS=4, TOTAL=COLS*ROWS, MAX_S=3;
const COLORS=['#3B82F6','#10B981','#F59E0B'];
const LW=4; // íš êµµê¸° (ìº”ë²„ìŠ¤ í”½ì…€)

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì…€ ìƒì„±
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const gridEl=document.getElementById('grid');
const cells=[];

for(let i=0;i<TOTAL;i++){
  const div=document.createElement('div');
  div.className='cell';

  const cvs=document.createElement('canvas');
  cvs.width=CVS_W;
  cvs.height=CVS_H;
  div.appendChild(cvs);
  gridEl.appendChild(div);

  const ctx=cvs.getContext('2d');
  ctx.lineCap='round'; ctx.lineJoin='round';

  cells.push({ el:div, cvs, ctx, strokes:[], pts:[], drawing:false, done:false });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í™œì„± ì…€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let activeIdx=0;
function activate(idx){
  cells.forEach((c,i)=>c.el.classList.toggle('active',i===idx&&!c.done));
  activeIdx=idx;
  syncDots(cells[idx]?.strokes.length??0);
}
activate(0);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì¸ë””ì¼€ì´í„°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function syncDots(n){
  [1,2,3].forEach(i=>{
    const d=document.getElementById('d'+i);
    d.classList.remove('on','done');
    if(i<n+1) d.classList.add('done');
    else if(i===n+1) d.classList.add('on');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í¬ì¸í„° ì¢Œí‘œ â†’ ìº”ë²„ìŠ¤ í”½ì…€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function evPt(e, cvs){
  const r=cvs.getBoundingClientRect();
  const cx=(e.clientX-r.left)*(CVS_W/r.width);
  const cy=(e.clientY-r.top)*(CVS_H/r.height);
  return {x:cx, y:cy};
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë“œë¡œì‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function drawCurve(ctx, pts, color){
  if(pts.length<2) return;
  ctx.save();
  ctx.strokeStyle=color; ctx.lineWidth=LW;
  ctx.beginPath();
  ctx.moveTo(pts[0].x,pts[0].y);
  for(let i=1;i<pts.length-1;i++){
    const mx=(pts[i].x+pts[i+1].x)/2, my=(pts[i].y+pts[i+1].y)/2;
    ctx.quadraticCurveTo(pts[i].x,pts[i].y,mx,my);
  }
  ctx.lineTo(pts[pts.length-1].x,pts[pts.length-1].y);
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(pts[0].x,pts[0].y,LW*1.1,0,Math.PI*2);
  ctx.fillStyle=color; ctx.fill();
  ctx.restore();
}

function redraw(c){
  c.ctx.clearRect(0,0,CVS_W,CVS_H);
  c.strokes.forEach((s,i)=>drawCurve(c.ctx,s,COLORS[i]));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   íšìˆœ ë¶„ì„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getFeatures(pts){
  const W=CVS_W, H=CVS_H;
  const xs=pts.map(p=>p.x), ys=pts.map(p=>p.y);
  const minX=Math.min(...xs), maxX=Math.max(...xs);
  const minY=Math.min(...ys), maxY=Math.max(...ys);
  const spanX=(maxX-minX)/W, spanY=(maxY-minY)/H;
  let len=0;
  for(let i=1;i<pts.length;i++){
    const dx=pts[i].x-pts[i-1].x, dy=pts[i].y-pts[i-1].y;
    len+=Math.sqrt(dx*dx+dy*dy);
  }
  return {
    sX:pts[0].x/W, sY:pts[0].y/H,
    eX:pts[pts.length-1].x/W, eY:pts[pts.length-1].y/H,
    spanX, spanY, len:len/(W+H)*2,
    horiz:spanX>spanY*1.05,
    vert:spanY>spanX*0.85,
    cX:(minX+maxX)/(2*W), cY:(minY+maxY)/(2*H),
  };
}

function judge(strokes){
  if(strokes.length!==3) return null;
  const [f0,f1,f2]=strokes.map(getFeatures);
  const errs=[]; let sc=0;

  // 1íš: ìƒë‹¨ ê°€ë¡œíš (Y<0.52, ê°€ë¡œë°©í–¥, ì˜¤ë¥¸ìª½)
  if(f0.sY<0.52 && (f0.horiz||f0.spanX>0.22) && f0.eX>=f0.sX-0.25){
    sc++;
  } else {
    if(f0.sY>=0.52)           errs.push('1íšì€ ìœ„ìª½ì—ì„œ ê°€ë¡œë¡œ ê·¸ì–´ì•¼ í•´ìš”');
    else if(!f0.horiz&&f0.spanX<=0.22) errs.push('1íšì€ ê°€ë¡œ ë°©í–¥ìœ¼ë¡œ ê·¸ì–´ì•¼ í•´ìš”');
    else                       errs.push('1íšì€ ì˜¤ë¥¸ìª½ ë°©í–¥ìœ¼ë¡œ ê·¸ì–´ì•¼ í•´ìš”');
  }

  // 2íš: ì„¸ë¡œ/ì‚¬ì„  (X<0.72, ì ì ˆí•œ Y ë²”ìœ„, ì•„ë˜ ë°©í–¥)
  if(f1.sX<0.75 && f1.sY>0.10 && f1.sY<0.75 && (f1.vert||f1.spanY>0.18)){
    sc++;
  } else {
    if(f1.sX>=0.75)            errs.push('2íšì€ ë” ì™¼ìª½(ì¤‘ì•™)ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”');
    else if(!(f1.vert||f1.spanY>0.18)) errs.push('2íšì€ ì•„ë˜ ë°©í–¥ìœ¼ë¡œ ë‚´ë ¤ê·¸ì–´ì•¼ í•´ìš”');
    else                        errs.push('2íš ì‹œì‘ ìœ„ì¹˜ë¥¼ ì¡°ì •í•´ ì£¼ì„¸ìš”');
  }

  // 3íš: í° ì›+ê¼¬ë¦¬ (X>0.15, Y<0.68, ê°€ì¥ ë³µì¡)
  const maxLen=Math.max(f0.len,f1.len,f2.len);
  const bigSpan=(f2.spanX+f2.spanY)>=(Math.max(f0.spanX+f0.spanY,f1.spanX+f1.spanY)*0.65);
  if(f2.sX>0.12 && f2.sY<0.70 && (f2.len>=maxLen*0.65||bigSpan)){
    sc++;
  } else {
    if(f2.sX<=0.12)            errs.push('3íšì€ ì˜¤ë¥¸ìª½ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”');
    else if(f2.sY>=0.70)       errs.push('3íšì€ ì¢€ ë” ìœ„ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”');
    else                        errs.push('3íšì„ ë” í¬ê²Œ ê·¸ë ¤ì£¼ì„¸ìš” (í° ì›+ê¼¬ë¦¬)');
  }

  return {sc, errs, ok:sc===3};
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í† ìŠ¤íŠ¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let tTimer;
function toast(msg,type='info',ms=1800){
  const el=document.getElementById('toast');
  el.textContent=msg; el.className=`show t-${type}`;
  clearTimeout(tTimer);
  tTimer=setTimeout(()=>{el.className='';},ms);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì´ë²¤íŠ¸ (Pointer Events API)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
cells.forEach((c,idx)=>{
  const {cvs}=c;

  cvs.addEventListener('pointerdown',e=>{
    e.preventDefault();
    cvs.setPointerCapture(e.pointerId);
    if(c.done){ toast('ì´ë¯¸ ì™„ì„±í•œ ì¹¸ì´ì—ìš”','info'); return; }
    activate(idx);
    if(c.strokes.length>=MAX_S){ toast('3íš ì™„ë£Œ! â†© ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¬ì„¸ìš”','info'); return; }
    c.drawing=true;
    c.pts=[evPt(e,cvs)];
  },{passive:false});

  cvs.addEventListener('pointermove',e=>{
    e.preventDefault();
    if(!c.drawing) return;
    c.pts.push(evPt(e,cvs));
    redraw(c);
    drawCurve(c.ctx,c.pts,COLORS[c.strokes.length]);
  },{passive:false});

  function end(e){
    if(!c.drawing) return;
    c.drawing=false;
    if(c.pts.length<4){ c.pts=[]; return; }

    c.strokes.push([...c.pts]);
    c.pts=[];
    redraw(c);
    syncDots(c.strokes.length);

    if(c.strokes.length===MAX_S){
      const res=judge(c.strokes);
      c.el.querySelectorAll('.badge').forEach(b=>b.remove());
      const badge=document.createElement('div');
      badge.className='badge';
      if(res.ok){
        badge.textContent='âœ“'; badge.style.color='#10B981';
        c.done=true; c.el.classList.remove('active');
        toast('ğŸ‰ íšìˆœ ì™„ë²½í•´ìš”!','ok',2500);
        const nxt=cells.findIndex((cc,i)=>i>idx&&!cc.done);
        if(nxt!==-1) setTimeout(()=>activate(nxt),800);
      } else {
        badge.textContent='âœ—'; badge.style.color='#EF4444';
        toast('âš ï¸ '+res.errs[0],'ng',3200);
      }
      c.el.appendChild(badge);
    } else {
      toast(`${c.strokes.length}íš ì™„ë£Œ âœ“  ë‚¨ì€ íš: ${MAX_S-c.strokes.length}ê°œ`,'info',1000);
    }
  }

  cvs.addEventListener('pointerup',end,{passive:false});
  cvs.addEventListener('pointercancel',end,{passive:false});
});

/* â”€â”€ ë²„íŠ¼ â”€â”€ */
document.getElementById('bUndo').addEventListener('click',()=>{
  const c=cells[activeIdx];
  if(!c||c.strokes.length===0){ toast('ì§€ìš¸ íšì´ ì—†ì–´ìš”','info'); return; }
  c.strokes.pop(); c.done=false;
  c.el.querySelectorAll('.badge').forEach(b=>b.remove());
  c.el.classList.add('active');
  redraw(c); syncDots(c.strokes.length);
  toast('â†© ë§ˆì§€ë§‰ íš ì·¨ì†Œ','info',900);
});

document.getElementById('bClear').addEventListener('click',()=>{
  cells.forEach(c=>{
    c.strokes=[]; c.pts=[]; c.drawing=false; c.done=false;
    c.el.querySelectorAll('.badge').forEach(b=>b.remove());
    c.el.classList.remove('active');
    c.ctx.clearRect(0,0,CVS_W,CVS_H);
  });
  activate(0);
  toast('ğŸ—‘ ì „ì²´ ì§€ì› ì–´ìš”!','info',1500);
});

syncDots(0);
</script>
</body>
</html>
