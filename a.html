<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ã‚ ì“°ê¸° ì—°ìŠµ v11</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html { width:100%; height:100%; }
body {
  width:100vw; height:100vh;
  overflow:hidden; background:transparent;
  font-family:'Apple SD Gothic Neo','Noto Sans KR',sans-serif;
  user-select:none; -webkit-user-select:none;
}
#app {
  position:fixed; left:0; top:0;
  width:100vw; height:100vh;
  background:transparent; pointer-events:none;
}

/* â•â• ìƒë‹¨ë°” â•â• */
#topbar {
  position:absolute;
  left:53.01724vw; top:24.06471vh;
  width:41.98276vw; height:3.8vh;
  display:flex; align-items:center; gap:0.5vw;
  pointer-events:none;
}
.dot {
  width:2.4vw; height:2.4vw;
  border-radius:50%; display:flex; align-items:center; justify-content:center;
  font-size:1.05vw; font-weight:900; color:#fff;
  opacity:.22; transition:opacity .3s,transform .3s;
  box-shadow:0 2px 6px rgba(0,0,0,.2); flex-shrink:0;
}
.dot.on   { opacity:1; transform:scale(1.25); }
.dot.done { opacity:.8; }
#d1{background:#3B82F6;} #d2{background:#10B981;} #d3{background:#F59E0B;}
#spc { flex:1; }
.tbtn {
  pointer-events:all;
  padding:0.4vh 0.8vw; border:none; border-radius:1.2vw;
  font-size:0.85vw; font-weight:800; cursor:pointer;
  box-shadow:0 2px 5px rgba(0,0,0,.15);
  transition:opacity .15s,transform .15s; white-space:nowrap; flex-shrink:0;
}
.tbtn:hover  { opacity:.82; transform:translateY(-1px); }
.tbtn:active { transform:translateY(0); }
#bUndo  { background:#8B5CF6; color:#fff; }
#bClear { background:#EF4444; color:#fff; }

/* â•â• ê²©ì â•â• */
#grid {
  position:absolute;
  left:53.01724vw; top:29.21175vh;
  width:41.98276vw; height:59.65997vh;
  pointer-events:none;
  display:grid;
  grid-template-columns: 8.53448vw 8.10345vw 8.64224vw 8.64224vw 8.06034vw;
  grid-template-rows:    14.52859vh 15.30139vh 15.30139vh 14.52859vh;
}
.cell {
  position:relative;
  cursor:crosshair; background:transparent;
  touch-action:none; pointer-events:all; overflow:hidden;
}
.cell.active::before {
  content:''; position:absolute; inset:2px;
  border:2px dashed rgba(99,102,241,.55);
  border-radius:3px; pointer-events:none;
  animation:blink 1.1s linear infinite; z-index:5;
}
@keyframes blink{50%{border-color:rgba(99,102,241,1);}}
.badge {
  position:absolute; bottom:2px; right:4px;
  font-size:0.85vw; font-weight:900;
  pointer-events:none; z-index:10;
}
.cell canvas {
  position:absolute; top:0; left:0;
  width:100%; height:100%;
  touch-action:none; display:block;
}

/* â•â• íš ì™„ë£Œ íŒì—… â•â• */
.spop {
  position:fixed; pointer-events:none; z-index:250;
  font-size:1.1vw; font-weight:900; letter-spacing:.02em;
  text-shadow:0 2px 6px rgba(0,0,0,.12);
  opacity:0; animation:spopAnim .85s ease forwards;
}
@keyframes spopAnim{
  0%  {opacity:0;transform:translateY(0) scale(.75);}
  20% {opacity:1;transform:translateY(-6px) scale(1.08);}
  65% {opacity:1;transform:translateY(-14px) scale(1.0);}
  100%{opacity:0;transform:translateY(-28px) scale(.9);}
}

/* â•â• ê²°ê³¼ íŒì—… â•â• */
#score-popup {
  position:absolute;
  left:74.63vw; top:50vh;
  transform:translate(-50%,-50%) scale(.92);
  background:#fff; border-radius:1.6vw;
  padding:1.4vh 1.8vw;
  box-shadow:0 12px 48px rgba(0,0,0,.22);
  text-align:center; pointer-events:none;
  opacity:0; z-index:500;
  transition:opacity .3s, transform .3s;
  min-width:15vw;
}
#score-popup.show {
  opacity:1; pointer-events:all;
  transform:translate(-50%,-52%) scale(1);
}
#score-ring {
  position:relative; width:6vw; height:6vw; margin:0 auto 0.5vh;
}
#score-ring svg{width:100%;height:100%;transform:rotate(-90deg);}
#score-ring .track{fill:none;stroke:#eee;stroke-width:7;}
#score-ring .fill {fill:none;stroke-width:7;stroke-linecap:round;
  transition:stroke-dashoffset 1.1s cubic-bezier(.4,0,.2,1);}
#score-num {
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  font-size:1.6vw; font-weight:900;
}
#analysis-text {
  font-size:0.73vw; color:#555; line-height:1.55;
  text-align:left; margin:0.4vh 0 0.7vh;
  padding:0.45vh 0.75vw;
  background:#f8f9fa; border-radius:0.7vw;
  border-left:3px solid #6366F1;
}
#score-close {
  padding:.35vh 1.3vw; background:#6366F1; color:#fff;
  border:none; border-radius:2vw;
  font-size:0.78vw; font-weight:800; cursor:pointer; transition:opacity .15s;
}
#score-close:hover{opacity:.85;}

/* â•â• í† ìŠ¤íŠ¸ â•â• */
#toast {
  position:absolute; left:74.07vw; top:20.5vh;
  transform:translateX(-50%);
  padding:.45vh 1.1vw; border-radius:1.0vw;
  font-size:.82vw; font-weight:800; white-space:nowrap;
  pointer-events:none; opacity:0; transition:opacity .2s; z-index:300;
  box-shadow:0 3px 12px rgba(0,0,0,.13);
}
#toast.show{opacity:1;}
.t-ok  {background:#10B981;color:#fff;}
.t-ng  {background:#EF4444;color:#fff;}
.t-info{background:rgba(255,255,255,.95);color:#333;border:1.5px solid #ddd;}
</style>
</head>
<body>
<div id="app">

  <div id="topbar">
    <div class="dot on" id="d1">1</div>
    <div class="dot"    id="d2">2</div>
    <div class="dot"    id="d3">3</div>
    <div id="spc"></div>
    <button class="tbtn" id="bUndo">â†© ì´ì „ íš</button>
    <button class="tbtn" id="bClear">ğŸ—‘ ì „ì²´ ì§€ìš°ê¸°</button>
  </div>

  <div id="grid"></div>
  <div id="toast"></div>

  <div id="score-popup">
    <div id="score-ring">
      <svg viewBox="0 0 60 60">
        <circle class="track" cx="30" cy="30" r="24"/>
        <circle class="fill" id="score-arc" cx="30" cy="30" r="24"
          stroke-dasharray="150.8" stroke-dashoffset="150.8"/>
      </svg>
      <div id="score-num">0%</div>
    </div>
    <div id="analysis-text"></div>
    <button id="score-close">í™•ì¸ â†’</button>
  </div>
</div>

<script>
/* â•â• íœ ìƒíƒœ (ê³ ì •) â•â• */
const PEN = {lw:.028, opacity:1.0, texture:false};
let curPen='g';
const curColor='#3B82F6'; // ê¸°ë³¸ìƒ‰ (ì‚¬ìš© ì•ˆ í•¨ - SCë¡œ ëŒ€ì²´)
const curThickness=2.5;

/* â•â• ë“±ê¸‰ â•â• */
const RING_COLOR=pct=>pct>=75?'#10B981':pct>=50?'#F59E0B':'#EF4444';

/* â•â• ì‹¤ì‹œê°„ ë¬¸êµ¬ â•â• */
const MSGS={
  perfect:['âœ¨Perfect','âš¡ì™„ë²½!','ğŸŒŸ'],
  good:   ['ğŸ‘Good','Nice!','OK!'],
  try:    ['âœ— ë‹¤ì‹œ','â†©Try','ì•„ì‰¬ì›Œ'],
};
const randMsg=t=>MSGS[t][Math.floor(Math.random()*MSGS[t].length)];

/* â•â• ë ˆí¼ëŸ°ìŠ¤ íš (Klee One, ì •ê·œí™” 0~1) â•â• */
const REF=[
  [[.18,.30],[.28,.28],[.40,.27],[.52,.27],[.62,.28],[.70,.31]],
  [[.47,.19],[.45,.29],[.42,.40],[.37,.52],[.30,.62],[.24,.72],[.20,.79]],
  [[.55,.31],[.65,.37],[.72,.49],[.70,.62],[.60,.73],[.46,.77],
   [.31,.72],[.24,.60],[.25,.46],[.33,.37],[.46,.33],[.58,.37],
   [.66,.47],[.64,.60]]
];

/* â•â• ì…€ ìƒì„± â•â• */
const COLS=5,ROWS=4,TOTAL=20,MAX_S=3;
const SC=['#3B82F6','#EF4444','#F59E0B']; // 1íš=íŒŒë‘, 2íš=ë¹¨ê°•, 3íš=ì£¼í™©
const CVS2=2;
const gridEl=document.getElementById('grid');
const cells=[];
for(let i=0;i<TOTAL;i++){
  const div=document.createElement('div');
  div.className='cell';
  const cvs=document.createElement('canvas');
  div.appendChild(cvs); gridEl.appendChild(div);
  const ctx=cvs.getContext('2d');
  ctx.lineCap='round'; ctx.lineJoin='round';
  cells.push({el:div,cvs,ctx,W:0,H:0,strokes:[],pts:[],drawing:false,done:false});
}

function initSizes(){
  cells.forEach(c=>{
    const r=c.el.getBoundingClientRect();
    const W=Math.round(r.width*CVS2),H=Math.round(r.height*CVS2);
    if(W>0&&H>0){c.cvs.width=W;c.cvs.height=H;c.W=W;c.H=H;}
  });
}
function tryInit(){initSizes();if(!cells[0].W)setTimeout(tryInit,80);else activate(0);}
document.addEventListener('DOMContentLoaded',()=>setTimeout(tryInit,60));
window.addEventListener('resize',()=>{initSizes();cells.forEach(c=>redraw(c));});

/* â•â• í™œì„±/ì¸ë””ì¼€ì´í„° â•â• */
let activeIdx=0;
function activate(i){
  cells.forEach((c,j)=>c.el.classList.toggle('active',j===i&&!c.done));
  activeIdx=i; syncDots(cells[i]?.strokes.length??0);
}
function syncDots(n){
  [1,2,3].forEach(i=>{
    const d=document.getElementById('d'+i);
    d.classList.remove('on','done');
    if(i<n+1)d.classList.add('done');
    else if(i===n+1)d.classList.add('on');
  });
}

/* â•â• ë“œë¡œì‰ â•â• */
function evPt(e,c){
  const r=c.cvs.getBoundingClientRect(),src=e.touches?e.touches[0]:e;
  return{x:(src.clientX-r.left)*(c.W/r.width),y:(src.clientY-r.top)*(c.H/r.height)};
}
function drawCurve(ctx,pts,color,W,_penKey,thickMul){
  if(pts.length<2)return;
  const p=PEN;
  const mul = thickMul !== undefined ? thickMul : curThickness;
  const lw=Math.max(1.5, W * p.lw * (mul/2.5));
  const layers=p.texture?3:1;
  ctx.save();
  for(let l=0;l<layers;l++){
    ctx.globalAlpha=p.opacity*(l===0?1:.14);
    ctx.strokeStyle=color; ctx.lineWidth=lw*(l===0?1:1+l*.3);
    ctx.lineCap='round';
    ctx.beginPath();
    ctx.moveTo(pts[0].x+l*.4,pts[0].y+l*.25);
    for(let i=1;i<pts.length-1;i++){
      const mx=(pts[i].x+pts[i+1].x)/2,my=(pts[i].y+pts[i+1].y)/2;
      ctx.quadraticCurveTo(pts[i].x+l*.4,pts[i].y+l*.25,mx,my);
    }
    ctx.lineTo(pts[pts.length-1].x+l*.4,pts[pts.length-1].y+l*.25);
    ctx.stroke();
  }
  ctx.globalAlpha=p.opacity;
  ctx.beginPath();ctx.arc(pts[0].x,pts[0].y,lw*1.15,0,Math.PI*2);
  ctx.fillStyle=color;ctx.fill();
  ctx.restore();
}
function redraw(c){
  if(!c.W)return;
  c.ctx.clearRect(0,0,c.W,c.H);
  c.strokes.forEach((s)=>drawCurve(c.ctx, s.pts, s.color, c.W, s.pen, s.thick));
}

/* â•â• íš ë¶„ì„ â•â• */
function analyzeStroke(idx,pts,W,H){
  const xs=pts.map(p=>p.x),ys=pts.map(p=>p.y);
  const minX=Math.min(...xs),maxX=Math.max(...xs);
  const minY=Math.min(...ys),maxY=Math.max(...ys);
  const sX=pts[0].x/W,sY=pts[0].y/H;
  const eX=pts[pts.length-1].x/W;
  const spanX=(maxX-minX)/W,spanY=(maxY-minY)/H;
  const cX=(minX+maxX)/(2*W),cY=(minY+maxY)/(2*H);
  const ref=REF[idx];
  const refCX=(Math.min(...ref.map(p=>p[0]))+Math.max(...ref.map(p=>p[0])))/2;
  const refCY=(Math.min(...ref.map(p=>p[1]))+Math.max(...ref.map(p=>p[1])))/2;
  const msgs=[];let ok=true;

  if(idx===0){
    if(sY>0.56){msgs.push('ì‹œì‘ì ì´ ë„ˆë¬´ ì•„ë˜ì˜ˆìš” â†’ ë” ìœ„ìª½ì—ì„œ ì‹œì‘í•´ ë³´ì„¸ìš”');ok=false;}
    else if(spanX<0.12){msgs.push('ê°€ë¡œíšì„ ë” ê¸¸ê²Œ ê·¸ì–´ ì£¼ì„¸ìš”');ok=false;}
    else if(eX<sX-0.22){msgs.push('ì˜¤ë¥¸ìª½ ë°©í–¥ìœ¼ë¡œ ê·¸ì–´ì•¼ í•´ìš”');ok=false;}
    else{
      const dX=cX-refCX;
      if(dX>0.15)msgs.push('íšì´ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì¹˜ìš°ì³ ìˆì–´ìš”');
      else if(dX<-0.15)msgs.push('íšì´ ì™¼ìª½ìœ¼ë¡œ ì¹˜ìš°ì³ ìˆì–´ìš”');
      const dY=cY-refCY;
      if(dY>0.13)msgs.push('ê°€ë¡œíšì˜ ìœ„ì¹˜ê°€ ë„ˆë¬´ ì•„ë˜ì˜ˆìš”');
    }
  } else if(idx===1){
    if(sX<0.03||sX>0.93){msgs.push('ì…€ ì•ˆìª½ì—ì„œ ì‹œì‘í•´ ì£¼ì„¸ìš”');ok=false;}
    else if(sY<0.03||sY>0.80){msgs.push('2íš ì‹œì‘ì ì„ ìœ„ìª½~ì¤‘ê°„ì— ë§ì¶°ì£¼ì„¸ìš”');ok=false;}
    else if(spanY<0.08){msgs.push('ì•„ë˜ ë°©í–¥ìœ¼ë¡œ ë” ë‚´ë ¤ê·¸ì–´ì•¼ í•´ìš”');ok=false;}
    else{
      if(cX>0.62)msgs.push('ì„¸ë¡œíšì´ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì¹˜ìš°ì³ ìˆì–´ìš”');
      else if(spanY<0.28)msgs.push('ë‘ ë²ˆì§¸ íšì„ ë” ê¸¸ê²Œ ë‚´ë ¤ê·¸ì–´ ë³´ì„¸ìš”');
    }
  } else {
    if(sX<0.05){msgs.push('3íšì€ ì˜¤ë¥¸ìª½ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”');ok=false;}
    else if(sY>0.82){msgs.push('3íšì€ ë” ìœ„ìª½ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”');ok=false;}
    else if(spanX+spanY<0.28){msgs.push('ì›ì„ ë” í¬ê²Œ ê·¸ë ¤ì£¼ì„¸ìš”');ok=false;}
    else{
      if(spanX<0.35)msgs.push('ì›ì´ ê°€ë¡œë¡œ ë„ˆë¬´ ì¢ì•„ìš”. ë” ë„“ê²Œ ê·¸ë ¤ë³´ì„¸ìš”');
      else if(spanY<0.35)msgs.push('ì›ì´ ì„¸ë¡œë¡œ ë„ˆë¬´ ë‚©ì‘í•´ìš”');
    }
  }
  const quality=!ok?'try':msgs.length===0?'perfect':'good';
  return{ok,msgs,quality};
}

/* â•â• íš ì™„ë£Œ íŒì—… â•â• */
function showStrokePop(cellEl,quality){
  const pop=document.createElement('div');
  pop.className='spop';
  pop.textContent=randMsg(quality);
  const colors={perfect:'#7C3AED',good:'#059669',try:'#DC2626'};
  pop.style.color=colors[quality];
  const r=cellEl.getBoundingClientRect();
  pop.style.left=(r.left+r.width*.25)+'px';
  pop.style.top= (r.top +r.height*.05)+'px';
  document.body.appendChild(pop);
  pop.addEventListener('animationend',()=>pop.remove());
}

/* â•â• ì •í™•ë„ ê³„ì‚° â•â• */
function calcAccuracy(strokes,W,H){
  if(strokes.length!==3)return null;
  const lw=Math.max(4,W*.09);
  const draw=(canvas,srcs,isRef)=>{
    const c=canvas.getContext('2d');
    c.lineCap='round';c.lineJoin='round';c.lineWidth=lw;c.strokeStyle='#000';
    srcs.forEach(pts=>{
      c.beginPath();
      if(isRef){
        c.moveTo(pts[0][0]*W,pts[0][1]*H);
        for(let i=1;i<pts.length-1;i++){
          const mx=(pts[i][0]+pts[i+1][0])/2*W,my=(pts[i][1]+pts[i+1][1])/2*H;
          c.quadraticCurveTo(pts[i][0]*W,pts[i][1]*H,mx,my);
        }
        c.lineTo(pts[pts.length-1][0]*W,pts[pts.length-1][1]*H);
      } else {
        c.moveTo(pts[0].x,pts[0].y);
        for(let i=1;i<pts.length-1;i++){
          const mx=(pts[i].x+pts[i+1].x)/2,my=(pts[i].y+pts[i+1].y)/2;
          c.quadraticCurveTo(pts[i].x,pts[i].y,mx,my);
        }
        c.lineTo(pts[pts.length-1].x,pts[pts.length-1].y);
      }
      c.stroke();
    });
    return c.getImageData(0,0,W,H).data;
  };
  const ocR=document.createElement('canvas');ocR.width=W;ocR.height=H;
  const ocS=document.createElement('canvas');ocS.width=W;ocS.height=H;
  const dR=draw(ocR,REF,true);
  const dS=draw(ocS,strokes,false);
  let inter=0,union=0;
  for(let i=3;i<W*H*4;i+=4){
    const a=dR[i]>20?1:0,b=dS[i]>20?1:0;
    if(a&&b)inter++;if(a||b)union++;
  }
  const iou=union===0?0:inter/union;
  return Math.min(100,Math.max(0,Math.round((iou-.07)/.37*100)));
}

/* â•â• ê²°ê³¼ íŒì—… â•â• */
function showResult(pct,allMsgs,cellEl){
  const C=150.8;
  const color=RING_COLOR(pct);
  const arc=document.getElementById('score-arc');
  arc.style.stroke=color; arc.style.strokeDashoffset=C;
  const num=document.getElementById('score-num');
  num.textContent=pct+'%'; num.style.color=color;

  // ë¶„ì„ í”¼ë“œë°±
  const at=document.getElementById('analysis-text');
  if(allMsgs.length>0){
    at.innerHTML=allMsgs.slice(0,2).map(m=>'ğŸ“ '+m).join('<br>');
    at.style.display='block';
  } else {
    at.innerHTML='âœ… íšìˆœê³¼ ìœ„ì¹˜ ëª¨ë‘ ì™„ë²½í•´ìš”!';
    at.style.display='block';
  }

  const popup=document.getElementById('score-popup');
  popup.classList.add('show');

  requestAnimationFrame(()=>requestAnimationFrame(()=>{
    arc.style.strokeDashoffset=C*(1-pct/100);
  }));
}
document.getElementById('score-close').addEventListener('click',()=>{
  document.getElementById('score-popup').classList.remove('show');
});

/* â•â• í† ìŠ¤íŠ¸ â•â• */
let tT;
function toast(msg,type='info',ms=1800){
  const el=document.getElementById('toast');
  el.textContent=msg;el.className=`show t-${type}`;
  clearTimeout(tT);tT=setTimeout(()=>el.className='',ms);
}

/* â•â• ì´ë²¤íŠ¸ â•â• */
cells.forEach((c,idx)=>{
  const{cvs}=c;
  cvs.addEventListener('pointerdown',e=>{
    e.preventDefault();e.stopPropagation();
    if(!c.W){initSizes();if(!c.W)return;}
    cvs.setPointerCapture(e.pointerId);
    if(c.done){toast('ì´ë¯¸ ì™„ì„±í•œ ì¹¸ì´ì—ìš” âœ“','info');return;}
    activate(idx);
    if(c.strokes.length>=MAX_S){toast('3íš ì™„ë£Œ! â†© ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¬ì„¸ìš”','info');return;}
    c.drawing=true;c.pts=[evPt(e,c)];
  },{passive:false});

  cvs.addEventListener('pointermove',e=>{
    e.preventDefault();e.stopPropagation();
    if(!c.drawing)return;
    c.pts.push(evPt(e,c));
    redraw(c);
    drawCurve(c.ctx,c.pts,SC[c.strokes.length],c.W,curPen,curThickness);
  },{passive:false});

  function onEnd(e){
    e.preventDefault();e.stopPropagation();
    if(!c.drawing)return;
    c.drawing=false;
    if(c.pts.length<4){c.pts=[];return;}
    const si=c.strokes.length;
    const strokeColor=SC[si]; // íšìˆœë³„ ê³ ì • ìƒ‰ìƒ
    const res=analyzeStroke(si,c.pts,c.W,c.H);
    c.strokes.push({pts:[...c.pts], color:strokeColor, pen:curPen, thick:curThickness});
    c.pts=[];
    redraw(c);syncDots(c.strokes.length);

    // ë°°ì§€
    c.el.querySelectorAll(`[data-s="${si}"]`).forEach(b=>b.remove());
    const bdg=document.createElement('div');
    bdg.className='badge';bdg.dataset.s=si;

    if(!res.ok){
      bdg.textContent=`${si+1}âœ—`;bdg.style.color='#EF4444';
      c.el.appendChild(bdg);
      showStrokePop(c.el,'try');
      toast(res.msgs[0],'ng',2500);
    } else {
      bdg.textContent=`${si+1}âœ“`;bdg.style.color=strokeColor;
      c.el.appendChild(bdg);
      showStrokePop(c.el,res.quality);
      if(res.msgs.length>0)toast('ğŸ’¡ '+res.msgs[0],'info',1800);

      if(c.strokes.length===MAX_S){
        c.done=true;c.el.classList.remove('active');
        setTimeout(()=>{
          const rawPts=c.strokes.map(s=>s.pts);
          const pct=calcAccuracy(rawPts,c.W,c.H)??0;
          const allMsgs=rawPts.flatMap((pts,i)=>analyzeStroke(i,pts,c.W,c.H).msgs);
          showResult(pct,allMsgs,c.el);
        },350);
        const nxt=cells.findIndex((cc,i)=>i>idx&&!cc.done);
        if(nxt!==-1)setTimeout(()=>activate(nxt),3400);
      }
    }
  }
  cvs.addEventListener('pointerup',onEnd,{passive:false});
  cvs.addEventListener('pointercancel',onEnd,{passive:false});
});

document.getElementById('bUndo').addEventListener('click',e=>{
  e.stopPropagation();
  const c=cells[activeIdx];
  if(!c||!c.strokes.length){toast('ì§€ìš¸ íšì´ ì—†ì–´ìš”','info');return;}
  const last=c.strokes.length-1;
  c.strokes.pop();c.done=false;
  c.el.querySelectorAll(`[data-s="${last}"]`).forEach(b=>b.remove());
  c.el.classList.add('active');
  redraw(c);syncDots(c.strokes.length);
  toast(`â†© ${last+1}íš ì·¨ì†Œ`,'info',900);
});

document.getElementById('bClear').addEventListener('click',e=>{
  e.stopPropagation();
  cells.forEach(c=>{
    c.strokes=[];c.pts=[];c.drawing=false;c.done=false;
    c.el.querySelectorAll('.badge').forEach(b=>b.remove());
    c.el.classList.remove('active');
    if(c.W)c.ctx.clearRect(0,0,c.W,c.H);
  });
  activate(0);
  toast('ğŸ—‘ ì „ì²´ ì§€ì› ì–´ìš”!','info',1400);
});

syncDots(0);
</script>
</body>
</html>
