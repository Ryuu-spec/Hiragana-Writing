<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ã‚ ì“°ê¸° ì—°ìŠµ v6</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body {
  width: 1200px; height: 675px;
  overflow: hidden;
  background: transparent;
  font-family: 'Apple SD Gothic Neo','Noto Sans KR',sans-serif;
  user-select: none; -webkit-user-select: none;
}
#app {
  position: absolute;
  /* ì˜¤ë¥¸ìª½ íŒ¨ë„ë§Œ ì»¤ë²„ - ì™¼ìª½ íŒ¨ë„ ì ˆëŒ€ ì¹¨ë²” ì•ˆ í•¨ */
  left: 641px; top: 0;
  width: 559px; height: 675px;
  background: transparent;
  overflow: hidden;
}

/* â”€â”€ ìƒë‹¨ ë°”: ì¸ë””ì¼€ì´í„° + ë²„íŠ¼ â”€â”€ */
#topbar {
  position: absolute;
  left: 0; top: 163px;
  width: 100%;
  display: flex;
  align-items: center;
  gap: 8px;
  pointer-events: none;
  z-index: 90;
}
.dot {
  width: 30px; height: 30px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 900; color: #fff;
  opacity: .25; transition: opacity .3s, transform .3s;
  box-shadow: 0 2px 6px rgba(0,0,0,.22);
  pointer-events: none;
}
.dot.on   { opacity:1; transform:scale(1.25); }
.dot.done { opacity:.85; }
#d1{background:#3B82F6;} #d2{background:#10B981;} #d3{background:#F59E0B;}

/* ì¸ë””ì¼€ì´í„°ì™€ ë²„íŠ¼ ì‚¬ì´ ì—¬ë°± */
#spacer { flex: 1; }

.tbtn {
  pointer-events: all;
  padding: 5px 13px;
  border: none; border-radius: 18px;
  font-size: 11px; font-weight: 800;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,.18);
  transition: opacity .15s, transform .15s;
  white-space: nowrap;
}
.tbtn:hover  { opacity:.82; transform:translateY(-1px); }
.tbtn:active { transform:translateY(0); }
#bUndo  { background:#8B5CF6; color:#fff; }
#bClear { background:#EF4444; color:#fff; margin-right: 8px; }

/* â”€â”€ ê²©ì â”€â”€ */
#grid {
  position: absolute;
  left: 0; top: 195px;
  width: 487px; height: 385px;
  display: grid;
  grid-template-columns: repeat(5, 97.4px);
  grid-template-rows: repeat(4, 96.25px);
  background: transparent;
  pointer-events: none; /* ê·¸ë¦¬ë“œ ìì²´ëŠ” ì´ë²¤íŠ¸ ì°¨ë‹¨ */
}
.cell {
  position: relative;
  width: 97.4px; height: 96.25px;
  cursor: crosshair;
  background: transparent;
  touch-action: none;
  pointer-events: all; /* ì…€ë§Œ ì´ë²¤íŠ¸ ìˆ˜ì‹  */
}
.cell.active::before {
  content:''; position:absolute; inset:2px;
  border: 2px dashed rgba(59,130,246,.55);
  border-radius: 3px; pointer-events:none;
  animation: blink 1.1s linear infinite;
}
@keyframes blink { 50%{ border-color:rgba(59,130,246,1); } }
.badge {
  position:absolute; bottom:3px; right:5px;
  font-size:15px; font-weight:900;
  pointer-events:none; line-height:1;
  z-index:10;
}
.cell canvas {
  position:absolute; top:0; left:0;
  width:97.4px; height:96.25px;
  touch-action:none; display:block;
}

/* â”€â”€ í† ìŠ¤íŠ¸ (ì˜¤ë¥¸ìª½ íŒ¨ë„ ìƒë‹¨) â”€â”€ */
#toast {
  position:absolute;
  left:244px; top:150px;
  transform:translateX(-50%);
  padding:8px 20px; border-radius:16px;
  font-size:13px; font-weight:800;
  white-space:nowrap; pointer-events:none;
  opacity:0; transition:opacity .2s; z-index:200;
  box-shadow:0 4px 16px rgba(0,0,0,.2);
}
#toast.show { opacity:1; }
.t-ok   { background:#10B981; color:#fff; }
.t-ng   { background:#EF4444; color:#fff; }
.t-warn { background:#F59E0B; color:#fff; }
.t-info { background:rgba(255,255,255,.95); color:#333; border:1.5px solid #ddd; }
</style>
</head>
<body>
<div id="app">

  <!-- ìƒë‹¨ë°”: ì¸ë””ì¼€ì´í„° + ë²„íŠ¼ -->
  <div id="topbar">
    <div class="dot on" id="d1">1</div>
    <div class="dot"    id="d2">2</div>
    <div class="dot"    id="d3">3</div>
    <div id="spacer"></div>
    <button class="tbtn" id="bUndo">â†© ì´ì „ íš</button>
    <button class="tbtn" id="bClear">ğŸ—‘ ì „ì²´ ì§€ìš°ê¸°</button>
  </div>

  <!-- ê²©ì -->
  <div id="grid"></div>

  <!-- í† ìŠ¤íŠ¸ -->
  <div id="toast"></div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ìƒìˆ˜
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COLS=5, ROWS=4, TOTAL=COLS*ROWS, MAX_S=3;
const COLORS=['#3B82F6','#10B981','#F59E0B'];
const LW = 3.8;
// ìº”ë²„ìŠ¤ ë‚´ë¶€ 2Ã— í•´ìƒë„
const CVS_W=195, CVS_H=193;
// CSS ì…€ í¬ê¸°
const CELL_W=97.4, CELL_H=96.25;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Klee One ã‚ íšìˆœ ê¸°ì¤€
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   1íš: ê°€ë¡œíš (ìƒë‹¨)
     Â· startY < 0.52
     Â· ê°€ë¡œ ë°©í–¥: spanX > 0.18
     Â· ì˜¤ë¥¸ìª½ìœ¼ë¡œ: endX > startX - 0.20

   2íš: ì„¸ë¡œ/ì‚¬ì„ íš (ì¤‘ì•™ ì„¸ë¡œ)
     Â· startX ë²”ìœ„ ë„“ê²Œ: 0.10 ~ 0.80  â† Klee Oneì—ì„œ ì¤‘ì•™ ì‹œì‘
     Â· startY: 0.10 ~ 0.65
     Â· ì„¸ë¡œ ìš”ì†Œ: spanY > 0.15  (ì•„ë˜ ë°©í–¥ìœ¼ë¡œ ì¶©ë¶„íˆ)
     Â· 2íšì€ 1íšë³´ë‹¤ ë°˜ë“œì‹œ ë‚˜ì¤‘ì— ê·¸ë¦´ ê²ƒ (ìˆœì„œ ì²´í¬)

   3íš: í° ì›+ê¼¬ë¦¬ (ê°€ì¥ ë³µì¡)
     Â· startX > 0.10
     Â· startY < 0.72
     Â· ì„¸ íš ì¤‘ spanX+spanY ê°€ì¥ í¬ê±°ë‚˜ len ê°€ì¥ ê¸¸ì–´ì•¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì…€ ìƒì„±
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const gridEl=document.getElementById('grid');
const cells=[];

for(let i=0;i<TOTAL;i++){
  const div=document.createElement('div');
  div.className='cell';
  const cvs=document.createElement('canvas');
  cvs.width=CVS_W; cvs.height=CVS_H;
  div.appendChild(cvs);
  gridEl.appendChild(div);
  const ctx=cvs.getContext('2d');
  ctx.lineCap='round'; ctx.lineJoin='round';
  cells.push({el:div,cvs,ctx,strokes:[],pts:[],drawing:false,done:false});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í™œì„± ì…€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let activeIdx=0;
function activate(idx){
  cells.forEach((c,i)=>c.el.classList.toggle('active',i===idx&&!c.done));
  activeIdx=idx;
  syncDots(cells[idx]?.strokes.length??0);
}
activate(0);

function syncDots(n){
  [1,2,3].forEach(i=>{
    const d=document.getElementById('d'+i);
    d.classList.remove('on','done');
    if(i<n+1) d.classList.add('done');
    else if(i===n+1) d.classList.add('on');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë“œë¡œì‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function evPt(e,cvs){
  const r=cvs.getBoundingClientRect();
  const src=e.touches?e.touches[0]:e;
  return {
    x:(src.clientX-r.left)*(CVS_W/r.width),
    y:(src.clientY-r.top)*(CVS_H/r.height)
  };
}

function drawCurve(ctx,pts,color){
  if(pts.length<2)return;
  ctx.save();
  ctx.strokeStyle=color; ctx.lineWidth=LW;
  ctx.beginPath();
  ctx.moveTo(pts[0].x,pts[0].y);
  for(let i=1;i<pts.length-1;i++){
    const mx=(pts[i].x+pts[i+1].x)/2, my=(pts[i].y+pts[i+1].y)/2;
    ctx.quadraticCurveTo(pts[i].x,pts[i].y,mx,my);
  }
  ctx.lineTo(pts[pts.length-1].x,pts[pts.length-1].y);
  ctx.stroke();
  // ì‹œì‘ì  ì›
  ctx.beginPath();
  ctx.arc(pts[0].x,pts[0].y,LW*1.2,0,Math.PI*2);
  ctx.fillStyle=color; ctx.fill();
  ctx.restore();
}

function redraw(c){
  c.ctx.clearRect(0,0,CVS_W,CVS_H);
  c.strokes.forEach((s,i)=>drawCurve(c.ctx,s,COLORS[i]));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   íš íŠ¹ì„± ì¶”ì¶œ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function feat(pts){
  const xs=pts.map(p=>p.x), ys=pts.map(p=>p.y);
  const minX=Math.min(...xs), maxX=Math.max(...xs);
  const minY=Math.min(...ys), maxY=Math.max(...ys);
  const spanX=(maxX-minX)/CVS_W, spanY=(maxY-minY)/CVS_H;
  let len=0;
  for(let i=1;i<pts.length;i++){
    const dx=pts[i].x-pts[i-1].x, dy=pts[i].y-pts[i-1].y;
    len+=Math.sqrt(dx*dx+dy*dy);
  }
  return {
    sX:pts[0].x/CVS_W, sY:pts[0].y/CVS_H,
    eX:pts[pts.length-1].x/CVS_W, eY:pts[pts.length-1].y/CVS_H,
    spanX, spanY,
    len:len/(CVS_W+CVS_H)*2,
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ê° íš ì¦‰ì‹œ íŒì • (íš ë²ˆí˜¸ 0,1,2)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function judgeStroke(strokeIdx, pts){
  const f=feat(pts);

  if(strokeIdx===0){
    // 1íš: ê°€ë¡œíš (ìƒë‹¨)
    if(f.sY>0.55)
      return {ok:false, msg:'1íšì€ ë” ìœ„ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš” (ìƒë‹¨ ê°€ë¡œíš)'};
    if(f.spanX<0.15 && f.spanY>f.spanX*1.5)
      return {ok:false, msg:'1íšì€ ê°€ë¡œ ë°©í–¥ìœ¼ë¡œ ê·¸ì–´ì•¼ í•´ìš”'};
    if(f.eX<f.sX-0.25)
      return {ok:false, msg:'1íšì€ ì˜¤ë¥¸ìª½ ë°©í–¥ìœ¼ë¡œ ê·¸ì–´ì•¼ í•´ìš”'};
    return {ok:true, msg:'1íš âœ“'};
  }

  if(strokeIdx===1){
    // 2íš: ì„¸ë¡œ/ì‚¬ì„ íš (Klee One ê¸°ì¤€ - ë²”ìœ„ ë„“ê²Œ)
    // ì‹œì‘ì  X: ì•„ì£¼ ë„“ê²Œ í—ˆìš© (0.08 ~ 0.85)
    if(f.sX<0.05 || f.sX>0.88)
      return {ok:false, msg:'2íš ì‹œì‘ì ì„ ì…€ ì•ˆìª½ì— ë§ì¶°ì£¼ì„¸ìš”'};
    // ì‹œì‘ì  Y: 0.08 ~ 0.70 í—ˆìš©
    if(f.sY<0.05 || f.sY>0.72)
      return {ok:false, msg:'2íšì€ ìœ„ìª½~ì¤‘ê°„ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”'};
    // ì„¸ë¡œ ë°©í–¥ ìš”ì†Œ í•„ìš” (ì•„ë˜ë¡œ ì¶©ë¶„íˆ)
    if(f.spanY<0.12)
      return {ok:false, msg:'2íšì€ ì•„ë˜ë¡œ ë‚´ë ¤ê·¸ì–´ì•¼ í•´ìš”'};
    return {ok:true, msg:'2íš âœ“'};
  }

  if(strokeIdx===2){
    // 3íš: í° ì›+ê¼¬ë¦¬
    if(f.sX<0.08)
      return {ok:false, msg:'3íšì€ ì˜¤ë¥¸ìª½ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”'};
    if(f.sY>0.75)
      return {ok:false, msg:'3íšì€ ë” ìœ„ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”'};
    if(f.spanX+f.spanY<0.35)
      return {ok:false, msg:'3íšì„ ë” í¬ê²Œ ê·¸ë ¤ì£¼ì„¸ìš” (í° ì›+ê¼¬ë¦¬)'};
    return {ok:true, msg:'3íš âœ“'};
  }
  return {ok:true, msg:''};
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í† ìŠ¤íŠ¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let tTimer;
function toast(msg,type='info',ms=1800){
  const el=document.getElementById('toast');
  el.textContent=msg; el.className=`show t-${type}`;
  clearTimeout(tTimer);
  tTimer=setTimeout(()=>{el.className='';},ms);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì´ë²¤íŠ¸ (Pointer Events)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
cells.forEach((c,idx)=>{
  const {cvs}=c;

  cvs.addEventListener('pointerdown',e=>{
    e.preventDefault();
    cvs.setPointerCapture(e.pointerId);
    if(c.done){toast('ì´ë¯¸ ì™„ì„±í•œ ì¹¸ì´ì—ìš” âœ“','info');return;}
    activate(idx);
    if(c.strokes.length>=MAX_S){toast('3íš ì™„ë£Œ! â†© ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¬ì„¸ìš”','info');return;}
    c.drawing=true;
    c.pts=[evPt(e,cvs)];
  },{passive:false});

  cvs.addEventListener('pointermove',e=>{
    e.preventDefault();
    if(!c.drawing)return;
    c.pts.push(evPt(e,cvs));
    redraw(c);
    drawCurve(c.ctx,c.pts,COLORS[c.strokes.length]);
  },{passive:false});

  function onEnd(e){
    if(!c.drawing)return;
    c.drawing=false;
    if(c.pts.length<4){c.pts=[];return;}

    const strokeIdx=c.strokes.length;
    const result=judgeStroke(strokeIdx,c.pts);

    c.strokes.push([...c.pts]);
    c.pts=[];
    redraw(c);
    syncDots(c.strokes.length);

    // â”€â”€ íš ì¦‰ì‹œ í”¼ë“œë°± â”€â”€
    if(!result.ok){
      // í‹€ë¦° íš í‘œì‹œ (ë¹¨ê°„ ë°°ì§€ + ì¦‰ì‹œ í”¼ë“œë°±)
      const badge=document.createElement('div');
      badge.className='badge';
      badge.textContent=`${strokeIdx+1}âœ—`;
      badge.style.color='#EF4444';
      badge.dataset.stroke=strokeIdx;
      c.el.querySelectorAll(`[data-stroke="${strokeIdx}"]`).forEach(b=>b.remove());
      c.el.appendChild(badge);
      toast(`âš ï¸ ${result.msg}  â†© ë¡œ ë‹¤ì‹œ ê·¸ì–´ë³´ì„¸ìš”`,'ng',3500);
    } else {
      // ë§ì€ íš í‘œì‹œ
      const badge=document.createElement('div');
      badge.className='badge';
      badge.textContent=`${strokeIdx+1}âœ“`;
      badge.style.color=COLORS[strokeIdx];
      badge.style.fontSize='12px';
      badge.dataset.stroke=strokeIdx;
      c.el.querySelectorAll(`[data-stroke="${strokeIdx}"]`).forEach(b=>b.remove());
      c.el.appendChild(badge);

      if(c.strokes.length<MAX_S){
        const left=MAX_S-c.strokes.length;
        toast(`${strokeIdx+1}íš ì™„ë£Œ âœ“  ë‚¨ì€ íš: ${left}ê°œ`,'info',1000);
      } else {
        // 3íš ëª¨ë‘ ì™„ë£Œ
        c.done=true;
        c.el.classList.remove('active');
        toast('ğŸ‰ ã‚ ì™„ì„±! ì˜ ì¼ì–´ìš”!','ok',2500);
        const nxt=cells.findIndex((cc,i)=>i>idx&&!cc.done);
        if(nxt!==-1) setTimeout(()=>activate(nxt),700);
      }
    }
  }

  cvs.addEventListener('pointerup',   onEnd,{passive:false});
  cvs.addEventListener('pointercancel',onEnd,{passive:false});
});

/* â”€â”€ ì´ì „ íš ì§€ìš°ê¸° â”€â”€ */
document.getElementById('bUndo').addEventListener('click',()=>{
  const c=cells[activeIdx];
  if(!c||c.strokes.length===0){toast('ì§€ìš¸ íšì´ ì—†ì–´ìš”','info');return;}
  const lastIdx=c.strokes.length-1;
  c.strokes.pop();
  c.done=false;
  // í•´ë‹¹ íš ë°°ì§€ ì œê±°
  c.el.querySelectorAll(`[data-stroke="${lastIdx}"]`).forEach(b=>b.remove());
  c.el.classList.add('active');
  redraw(c);
  syncDots(c.strokes.length);
  toast(`â†© ${lastIdx+1}íš ì·¨ì†Œ`,'info',900);
});

/* â”€â”€ ì „ì²´ ì§€ìš°ê¸° â”€â”€ */
document.getElementById('bClear').addEventListener('click',()=>{
  cells.forEach(c=>{
    c.strokes=[]; c.pts=[]; c.drawing=false; c.done=false;
    c.el.querySelectorAll('.badge').forEach(b=>b.remove());
    c.el.classList.remove('active');
    c.ctx.clearRect(0,0,CVS_W,CVS_H);
  });
  activate(0);
  toast('ğŸ—‘ ì „ì²´ ì§€ì› ì–´ìš”!','info',1500);
});

syncDots(0);
</script>
</body>
</html>
