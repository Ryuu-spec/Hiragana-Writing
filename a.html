<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ã‚ ì“°ê¸° ì—°ìŠµ v7</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body {
  width: 1200px; height: 675px;
  overflow: hidden;
  background: transparent;
  font-family: 'Apple SD Gothic Neo','Noto Sans KR',sans-serif;
  user-select: none; -webkit-user-select: none;
}

/* â”€â”€ ì „ì²´ ì»¨í…Œì´ë„ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   1200Ã—675 ì „ì²´ë¥¼ ì±„ìš°ì§€ë§Œ pointer-events:none
   â†’ ì™¼ìª½ íŒ¨ë„Â·ìŠ¬ë¼ì´ë“œ ë°°ê²½ í´ë¦­ ì™„ì „ í†µê³¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app {
  position: absolute;
  left: 0; top: 0;
  width: 1200px; height: 675px;
  background: transparent;
  pointer-events: none; /* ê¸°ë³¸ê°’: ì´ë²¤íŠ¸ ì°¨ë‹¨ ì•ˆ í•¨ â†’ ë°°ê²½ í†µê³¼ */
}

/* â”€â”€ ìƒë‹¨ ë°” (ì¸ë””ì¼€ì´í„° + ë²„íŠ¼) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#topbar {
  position: absolute;
  left: 640px; top: 163px;
  width: 484px;              /* ê²©ì ë„ˆë¹„ì™€ ë™ì¼ */
  height: 30px;
  display: flex;
  align-items: center;
  gap: 7px;
  pointer-events: none;
}
.dot {
  width: 28px; height: 28px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 900; color: #fff;
  opacity: .25;
  transition: opacity .3s, transform .3s;
  box-shadow: 0 2px 6px rgba(0,0,0,.22);
  flex-shrink: 0;
}
.dot.on   { opacity:1; transform:scale(1.22); }
.dot.done { opacity:.85; }
#d1{background:#3B82F6;} #d2{background:#10B981;} #d3{background:#F59E0B;}

#spacer { flex:1; min-width: 0; }

.tbtn {
  pointer-events: all;   /* ë²„íŠ¼ë§Œ ì´ë²¤íŠ¸ í™œì„±í™” */
  padding: 5px 11px;
  border: none; border-radius: 16px;
  font-size: 11px; font-weight: 800;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,.2);
  transition: opacity .15s, transform .15s;
  white-space: nowrap;
  flex-shrink: 0;
}
.tbtn:hover  { opacity:.82; transform:translateY(-1px); }
.tbtn:active { transform:translateY(0); }
#bUndo  { background:#8B5CF6; color:#fff; }
#bClear { background:#EF4444; color:#fff; }

/* â”€â”€ ê²©ì ì»¨í…Œì´ë„ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#grid {
  position: absolute;
  left: 640px; top: 197px;
  width: 484px; height: 387px;
  pointer-events: none; /* ì…€ë“¤ì´ ê°œë³„ ì´ë²¤íŠ¸ ì²˜ë¦¬ */
}

/* â”€â”€ ê° ì…€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cell {
  position: absolute;
  width: 96.8px; height: 96.75px;
  cursor: crosshair;
  background: transparent;
  touch-action: none;
  pointer-events: all; /* ì…€ë§Œ ì´ë²¤íŠ¸ ìˆ˜ì‹  */
  overflow: visible;
}

/* ì…€ ìœ„ì¹˜: col(0~4) Ã— row(0~3) */
/* JSì—ì„œ ì§ì ‘ style.left/top ì„¤ì • */

.cell.active::before {
  content:''; position:absolute; inset:1px;
  border: 2px dashed rgba(59,130,246,.6);
  border-radius: 3px; pointer-events:none;
  animation: blink 1.1s linear infinite;
  z-index: 5;
}
@keyframes blink { 50%{ border-color:rgba(59,130,246,1); } }

.badge {
  position:absolute; bottom:2px; right:4px;
  font-size:13px; font-weight:900;
  pointer-events:none; line-height:1; z-index:10;
}

.cell canvas {
  position:absolute; top:0; left:0;
  width:96.8px; height:96.75px;
  touch-action:none; display:block;
}

/* â”€â”€ í† ìŠ¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast {
  position:absolute;
  left: 882px; top: 158px;
  transform: translateX(-50%);
  padding: 7px 18px; border-radius:14px;
  font-size:12px; font-weight:800;
  white-space:nowrap; pointer-events:none;
  opacity:0; transition:opacity .2s; z-index:300;
  box-shadow:0 4px 16px rgba(0,0,0,.2);
  max-width: 280px;
  text-align: center;
}
#toast.show { opacity:1; }
.t-ok   { background:#10B981; color:#fff; }
.t-ng   { background:#EF4444; color:#fff; }
.t-info { background:rgba(255,255,255,.95); color:#333; border:1.5px solid #ddd; }
</style>
</head>
<body>
<div id="app">

  <!-- ìƒë‹¨ë°” -->
  <div id="topbar">
    <div class="dot on" id="d1">1</div>
    <div class="dot"    id="d2">2</div>
    <div class="dot"    id="d3">3</div>
    <div id="spacer"></div>
    <button class="tbtn" id="bUndo">â†© ì´ì „ íš</button>
    <button class="tbtn" id="bClear">ğŸ—‘ ì „ì²´ ì§€ìš°ê¸°</button>
  </div>

  <!-- ê²©ì (ì…€ì€ JSë¡œ ìƒì„±) -->
  <div id="grid"></div>

  <!-- í† ìŠ¤íŠ¸ -->
  <div id="toast"></div>

</div>
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ìƒìˆ˜
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COLS=5, ROWS=4, TOTAL=COLS*ROWS, MAX_S=3;
const COLORS=['#3B82F6','#10B981','#F59E0B'];
const LW=3.5;
const CVS_W=194, CVS_H=194;           // ìº”ë²„ìŠ¤ ë‚´ë¶€ í•´ìƒë„
const CELL_W=96.8, CELL_H=96.75;      // CSS ì…€ í¬ê¸°

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì…€ ìƒì„± (ì ˆëŒ€ ì¢Œí‘œë¡œ ë°°ì¹˜)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const gridEl=document.getElementById('grid');
const cells=[];

for(let i=0;i<TOTAL;i++){
  const col=i%COLS, row=Math.floor(i/COLS);

  const div=document.createElement('div');
  div.className='cell';
  div.style.left = (col * CELL_W)+'px';
  div.style.top  = (row * CELL_H)+'px';

  const cvs=document.createElement('canvas');
  cvs.width=CVS_W; cvs.height=CVS_H;
  div.appendChild(cvs);
  gridEl.appendChild(div);

  const ctx=cvs.getContext('2d');
  ctx.lineCap='round'; ctx.lineJoin='round';
  cells.push({el:div, cvs, ctx, strokes:[], pts:[], drawing:false, done:false});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í™œì„± ì…€ ê´€ë¦¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let activeIdx=0;
function activate(idx){
  cells.forEach((c,i)=>c.el.classList.toggle('active',i===idx&&!c.done));
  activeIdx=idx;
  syncDots(cells[idx]?.strokes.length??0);
}
activate(0);

function syncDots(n){
  [1,2,3].forEach(i=>{
    const d=document.getElementById('d'+i);
    d.classList.remove('on','done');
    if(i<n+1)      d.classList.add('done');
    else if(i===n+1) d.classList.add('on');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë“œë¡œì‰ ìœ í‹¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function evPt(e,cvs){
  const r=cvs.getBoundingClientRect();
  const src=e.touches?e.touches[0]:e;
  return {
    x:(src.clientX-r.left)*(CVS_W/r.width),
    y:(src.clientY-r.top )*(CVS_H/r.height)
  };
}

function drawCurve(ctx,pts,color){
  if(pts.length<2)return;
  ctx.save();
  ctx.strokeStyle=color; ctx.lineWidth=LW;
  ctx.beginPath();
  ctx.moveTo(pts[0].x,pts[0].y);
  for(let i=1;i<pts.length-1;i++){
    const mx=(pts[i].x+pts[i+1].x)/2,my=(pts[i].y+pts[i+1].y)/2;
    ctx.quadraticCurveTo(pts[i].x,pts[i].y,mx,my);
  }
  ctx.lineTo(pts[pts.length-1].x,pts[pts.length-1].y);
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(pts[0].x,pts[0].y,LW*1.2,0,Math.PI*2);
  ctx.fillStyle=color; ctx.fill();
  ctx.restore();
}

function redraw(c){
  c.ctx.clearRect(0,0,CVS_W,CVS_H);
  c.strokes.forEach((s,i)=>drawCurve(c.ctx,s,COLORS[i]));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Klee One ã‚ íšìˆœ ì¦‰ì‹œ íŒì •
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   1íš: ìƒë‹¨ ê°€ë¡œíš
   2íš: ì¤‘ì•™ ì„¸ë¡œ/ì‚¬ì„  (ë²”ìœ„ ê´€ëŒ€)
   3íš: ì˜¤ë¥¸ìª½ í° ì›+ê¼¬ë¦¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function judgeStroke(idx,pts){
  const xs=pts.map(p=>p.x), ys=pts.map(p=>p.y);
  const minX=Math.min(...xs),maxX=Math.max(...xs);
  const minY=Math.min(...ys),maxY=Math.max(...ys);
  const W=CVS_W,H=CVS_H;
  const sX=pts[0].x/W, sY=pts[0].y/H;
  const eX=pts[pts.length-1].x/W;
  const spanX=(maxX-minX)/W, spanY=(maxY-minY)/H;
  let len=0;
  for(let i=1;i<pts.length;i++){
    const dx=pts[i].x-pts[i-1].x,dy=pts[i].y-pts[i-1].y;
    len+=Math.sqrt(dx*dx+dy*dy);
  }
  len/=(W+H)/2;

  /* 1íš: ê°€ë¡œíš â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Â· ì‹œì‘ Y < 0.55  (ìƒë‹¨ ì ˆë°˜)
     Â· spanX > 0.15   (ê°€ë¡œ ìš”ì†Œ ì¶©ë¶„)
     Â· eX > sX - 0.20 (ì˜¤ë¥¸ìª½ ë°©í–¥)  */
  if(idx===0){
    if(sY>0.56)
      return {ok:false,msg:'1íšì€ ë” ìœ„ìª½ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”'};
    if(spanX<0.12)
      return {ok:false,msg:'1íšì€ ê°€ë¡œë¡œ ë” ê¸¸ê²Œ ê·¸ì–´ì•¼ í•´ìš”'};
    if(eX<sX-0.22)
      return {ok:false,msg:'1íšì€ ì˜¤ë¥¸ìª½ ë°©í–¥ìœ¼ë¡œ ê·¸ì–´ì•¼ í•´ìš”'};
    return {ok:true,msg:'1íš âœ“'};
  }

  /* 2íš: ì„¸ë¡œ/ì‚¬ì„  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Klee One ã‚ì—ì„œ 2íšì€
     1íšê³¼ êµì°¨í•˜ëŠ” ì§€ì (ì…€ ì¤‘ì•™ ê·¼ì²˜)ì—ì„œ
     ì‹œì‘í•´ì„œ ì•„ë˜ë¡œ ë‚´ë ¤ì˜´.
     Â· sX: 0.05 ~ 0.90  (ë§¤ìš° ë„“ê²Œ)
     Â· sY: 0.05 ~ 0.75  (ë„“ê²Œ)
     Â· spanY > 0.10      (ì•„ë˜ ë°©í–¥)   */
  if(idx===1){
    if(sX<0.03||sX>0.92)
      return {ok:false,msg:'2íšì„ ì…€ ì•ˆìª½ì—ì„œ ì‹œì‘í•´ ì£¼ì„¸ìš”'};
    if(sY<0.03||sY>0.78)
      return {ok:false,msg:'2íš ì‹œì‘ ìœ„ì¹˜ë¥¼ ì¡°ì •í•´ ì£¼ì„¸ìš”'};
    if(spanY<0.08)
      return {ok:false,msg:'2íšì€ ì•„ë˜ ë°©í–¥ìœ¼ë¡œ ë‚´ë ¤ê·¸ì–´ì•¼ í•´ìš”'};
    return {ok:true,msg:'2íš âœ“'};
  }

  /* 3íš: í° ì›+ê¼¬ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Â· sX > 0.08
     Â· sY < 0.78
     Â· spanX+spanY > 0.30  (í¬ê²Œ)     */
  if(idx===2){
    if(sX<0.05)
      return {ok:false,msg:'3íšì€ ì˜¤ë¥¸ìª½ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”'};
    if(sY>0.80)
      return {ok:false,msg:'3íšì€ ë” ìœ„ìª½ì—ì„œ ì‹œì‘í•´ì•¼ í•´ìš”'};
    if(spanX+spanY<0.28)
      return {ok:false,msg:'3íšì„ ë” í¬ê²Œ ê·¸ë ¤ì£¼ì„¸ìš” (í° ì›+ê¼¬ë¦¬)'};
    return {ok:true,msg:'3íš âœ“'};
  }
  return {ok:true,msg:''};
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   í† ìŠ¤íŠ¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let tTimer;
function toast(msg,type='info',ms=1800){
  const el=document.getElementById('toast');
  el.textContent=msg;
  el.className=`show t-${type}`;
  clearTimeout(tTimer);
  tTimer=setTimeout(()=>{el.className='';},ms);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì´ë²¤íŠ¸ (Pointer Events API)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
cells.forEach((c,idx)=>{
  const {cvs}=c;

  cvs.addEventListener('pointerdown',e=>{
    e.preventDefault(); e.stopPropagation();
    cvs.setPointerCapture(e.pointerId);
    if(c.done){toast('ì´ë¯¸ ì™„ì„±í•œ ì¹¸ì´ì—ìš” âœ“','info');return;}
    activate(idx);
    if(c.strokes.length>=MAX_S){toast('3íš ì™„ë£Œ! â†© ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¬ì„¸ìš”','info');return;}
    c.drawing=true;
    c.pts=[evPt(e,cvs)];
  },{passive:false});

  cvs.addEventListener('pointermove',e=>{
    e.preventDefault(); e.stopPropagation();
    if(!c.drawing)return;
    c.pts.push(evPt(e,cvs));
    redraw(c);
    drawCurve(c.ctx,c.pts,COLORS[c.strokes.length]);
  },{passive:false});

  function onEnd(e){
    e.preventDefault(); e.stopPropagation();
    if(!c.drawing)return;
    c.drawing=false;
    if(c.pts.length<4){c.pts=[];return;}

    const sIdx=c.strokes.length;
    const result=judgeStroke(sIdx,c.pts);

    c.strokes.push([...c.pts]);
    c.pts=[];
    redraw(c);
    syncDots(c.strokes.length);

    // ê¸°ì¡´ ë°°ì§€ ì œê±° í›„ ìƒˆ ë°°ì§€
    c.el.querySelectorAll(`[data-s="${sIdx}"]`).forEach(b=>b.remove());
    const badge=document.createElement('div');
    badge.className='badge';
    badge.dataset.s=sIdx;

    if(!result.ok){
      badge.textContent=`${sIdx+1}âœ—`;
      badge.style.color='#EF4444';
      c.el.appendChild(badge);
      toast(`âš ï¸ ${result.msg}`,'ng',3000);
    } else {
      badge.textContent=`${sIdx+1}âœ“`;
      badge.style.color=COLORS[sIdx];
      badge.style.fontSize='11px';
      c.el.appendChild(badge);

      if(c.strokes.length<MAX_S){
        toast(`${sIdx+1}íš ì™„ë£Œ âœ“  ë‹¤ìŒ: ${sIdx+2}íš`,'info',1000);
      } else {
        c.done=true;
        c.el.classList.remove('active');
        toast('ğŸ‰ ã‚ ì™„ì„±! ë‹¤ìŒ ì¹¸ìœ¼ë¡œ ì´ë™í•´ìš”','ok',2200);
        const nxt=cells.findIndex((cc,i)=>i>idx&&!cc.done);
        if(nxt!==-1) setTimeout(()=>activate(nxt),700);
      }
    }
  }

  cvs.addEventListener('pointerup',    onEnd,{passive:false});
  cvs.addEventListener('pointercancel',onEnd,{passive:false});
});

/* â”€â”€ ì´ì „ íš ì§€ìš°ê¸° â”€â”€ */
document.getElementById('bUndo').addEventListener('click',e=>{
  e.stopPropagation();
  const c=cells[activeIdx];
  if(!c||c.strokes.length===0){toast('ì§€ìš¸ íšì´ ì—†ì–´ìš”','info');return;}
  const last=c.strokes.length-1;
  c.strokes.pop(); c.done=false;
  c.el.querySelectorAll(`[data-s="${last}"]`).forEach(b=>b.remove());
  c.el.classList.add('active');
  redraw(c); syncDots(c.strokes.length);
  toast(`â†© ${last+1}íš ì·¨ì†Œ`,'info',900);
});

/* â”€â”€ ì „ì²´ ì§€ìš°ê¸° â”€â”€ */
document.getElementById('bClear').addEventListener('click',e=>{
  e.stopPropagation();
  cells.forEach(c=>{
    c.strokes=[]; c.pts=[]; c.drawing=false; c.done=false;
    c.el.querySelectorAll('.badge').forEach(b=>b.remove());
    c.el.classList.remove('active');
    c.ctx.clearRect(0,0,CVS_W,CVS_H);
  });
  activate(0);
  toast('ğŸ—‘ ì „ì²´ ì§€ì› ì–´ìš”!','info',1500);
});

syncDots(0);
</script>
</body>
</html>
